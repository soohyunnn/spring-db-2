# ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ  - ì‹œì‘

## ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ  ì§„í–‰ ë°©ì‹ ì†Œê°œ

ì•ìœ¼ë¡œ ì‹¤ë¬´ì—ì„œ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë‹¤ì–‘í•œ ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ ë“¤ì„ í•™ìŠµí•œë‹¤.

**ì ìš© ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ **

- JdbcTemplate
- MyBatis
- JPA, Hibernate
- ìŠ¤í”„ë§ ë°ì´í„° JPA
- Querydsl

ì—¬ê¸°ì—ëŠ” í¬ê²Œ 2ê°€ì§€ ë¶„ë¥˜ê°€ ìˆë‹¤.

**SQLMapper**

- jdbcTemplate
- MyBatis

**ORM ê´€ë ¨ ê¸°ìˆ **

- JPA. Hibernate
- ìŠ¤í”„ë§ ë°ì´í„° JPA
- Querydsl

**SQL Mapper ì£¼ìš” ê¸°ëŠ¥**

- ê°œë°œìëŠ” SQLë§Œ ì‘ì„±í•˜ë©´ í•´ë‹¹ SQLì˜ ê²°ê³¼ë¥¼ ê°ì²´ë¡œ í¸ë¦¬í•˜ê²Œ ë§¤í•‘í•´ì¤€ë‹¤.
- JDBCë¥¼ ì§ì ‘ ì‚¬ìš©í•  ë•Œ ë°œìƒí•˜ëŠ” ì—¬ëŸ¬ê°€ì§€ ì¤‘ë³µì„ ì œê±°í•´ì£¼ê³ , ê¸°íƒ€ ê°œë°œìì—ê²Œ ì—¬ëŸ¬ê°€ì§€ í¸ë¦¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

**ORM ì£¼ìš” ê¸°ëŠ¥**

- JdbcTemplateì´ë‚˜ MyBatis ê°™ì€ SQL ë§¤í¼ ê¸°ìˆ ì€ SQLì„ ê°œë°œìê°€ ì§ì ‘ ì‘ì„±í•´ì•¼ í•˜ì§€ë§Œ, JPAë¥¼ ì‚¬ìš©í•˜ë©´ ê¸°ë³¸ì ì¸ SQLì€ JPAê°€ ëŒ€ì‹  ì‘ì„±í•˜ê³  ì²˜ë¦¬í•´ì¤€ë‹¤. ê°œë°œìëŠ” ì €ì¥í•˜ê³  ì‹¶ì€ ê°ì²´ë¥¼ ë§ˆì¹˜ ìë°” ì»¬ë ‰ì…˜ì— ì €ì¥í•˜ê³  ì¡°íšŒí•˜ë“¯ì´ ì‚¬ìš©í•˜ë©´ ORM ê¸°ìˆ ì´ ë°ì´í„°ë² ì´ìŠ¤ì— í•´ë‹¹ ê°ì²´ë¥¼ ì €ì¥í•˜ê³  ì¡°íšŒí•´ì¤€ë‹¤.
- JPAëŠ” ìë°” ì§„ì˜ì˜ ORM í‘œì¤€ì´ê³ , Hibernate(í•˜ì´ë²„ë„¤ì´íŠ¸)ëŠ” JPAì—ì„œ ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” êµ¬í˜„ì²´ì´ë‹¤. ìë°”ì—ì„œ ORMì„ ì‚¬ìš©í•  ë•ŒëŠ” JPA ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³ , ê·¸ êµ¬í˜„ì²´ë¡œ í•˜ì´ë²„ë„¤ì´íŠ¸ë¥¼ ì‚¬ìš©í•œë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.
- ìŠ¤í”„ë§ ë°ì´í„° JPA, Querydslì€ JPAë¥¼ ë” í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” í”„ë¡œì íŠ¸ì´ë‹¤. ì‹¤ë¬´ì—ì„œëŠ” JPAë¥¼ ì‚¬ìš©í•˜ë©´ ì´ í”„ë¡œì íŠ¸ë„ ê¼­! í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤. ê°œì¸ì ìœ¼ë¡œ ê±°ì˜ í•„ìˆ˜ë¼ ìƒê°í•œë‹¤.

**ì´ë²ˆ ê°•ì˜ì˜ ëª©í‘œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.**

- ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ ì— ëŒ€í•œ ê¸°ë³¸ ì´í•´ì™€ ì „ì²´ í° ê·¸ë¦¼ì„ ê·¸ë¦°ë‹¤.
- ê° ê¸°ìˆ ë“¤ì˜ í•µì‹¬ ê¸°ëŠ¥ ìœ„ì£¼ë¡œ í•™ìŠµí•œë‹¤.
- ê° ê¸°ìˆ ë“¤ì„ ì ì§„ì ìœ¼ë¡œ ë„ì…í•˜ëŠ” ê³¼ì •ì„ í†µí•´ì„œ ê° ê¸°ìˆ ì˜ íŠ¹ì§•ê³¼ ì¥ë‹¨ì ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì´í•´í•  ìˆ˜ ìˆë‹¤.

## í”„ë¡œì íŠ¸ ì„¤ì •ê³¼ ë©”ëª¨ë¦¬ ì €ì¥ì†Œ

[itemservice-db.zip](https://github.com/soohyunnn/spring-db-2/files/11642210/itemservice-db.zip)

ì´ í”„ë¡œì íŠ¸ë¥¼ ë‹¤ìš´ë°›ì•„ì„œ ì‹¤ìŠµì„ í•˜ë©´ ëœë‹¤.

## í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ëª…1 - ê¸°ë³¸

ì œê³µë˜ëŠ” í”„ë¡œì íŠ¸ ëŒ€í•´ì„œ í•˜ë‚˜ì”© ì•Œì•„ë³´ì.

âš ï¸Â ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0ì´ì–´ì„œ ì£¼ì˜í•´ì•¼ í•  ì ì€ Spring ì²« í˜ì´ì§€ì— ì •ë¦¬í•´ë†¨ìœ¼ë‹ˆ ì°¸ê³ í•˜ì!

ìŠ¤í”„ë§ ë¶€íŠ¸ 3.0 ê´€ë ¨ ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒ ë§í¬ë¥¼ í™•ì¸í•˜ì : [https://bit.ly/springboot3](https://bit.ly/springboot3)

**build.gradle íŒŒì¼ì„ ì°¸ê³ í•˜ì.**

- `spring-boot-starter-thymeleaf` : íƒ€ì„ë¦¬í”„ ì‚¬ìš©
- `spring-boot-starter-web` : ìŠ¤í”„ë§ ì›¹, MVC ê¸°ëŠ¥ ì‚¬ìš©
- `spring-boot-starter-test` : ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥
- `lombok` : lombokì„ ì¶”ê°€ë¡œ í…ŒìŠ¤íŠ¸ì—ì„œë„ ì‚¬ìš©í•˜ëŠ” ì„¤ì • ì£¼ì˜

### ë„ë©”ì¸ ë¶„ì„

**Item**

```java
package hello.itemservice.domain;

import lombok.Data;

@Data
public class Item {

    private Long id;

    private String itemName;
    private Integer price;
    private Integer quantity;

    public Item() {
    }

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```

- `Item` ì€ ìƒí’ˆ ìì²´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°ì²´ì´ë‹¤. ì´ë¦„, ê°€ê²©, ìˆ˜ëŸ‰ì„ ì†ì„±ìœ¼ë¡œ ê°€ì§€ê³  ìˆë‹¤.

### ë¦¬í¬ì§€í† ë¦¬ ë¶„ì„

**ItemRepository ì¸í„°í˜ì´ìŠ¤**

```java
package hello.itemservice.domain;

import lombok.Data;

@Data
public class Item {

    private Long id;

    private String itemName;
    private Integer price;
    private Integer quantity;

    public Item() {
    }

    public Item(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```

- ë©”ëª¨ë¦¬ êµ¬í˜„ì²´ì—ì„œ í–¥í›„ ë‹¤ì–‘í•œ ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ  êµ¬í˜„ì²´ë¡œ ì†ì‰½ê²Œ ë³€ê²½í•˜ê¸° ìœ„í•´ ë¦¬í¬ì§€í† ë¦¬ì— ì¸í„°í˜ì´ìŠ¤ë¥¼ ë„ì…í–ˆë‹¤.

**ItemSearchCond**

```java
package hello.itemservice.repository;

import lombok.Data;

@Data
public class ItemSearchCond {

    private String itemName;
    private Integer maxPrice;

    public ItemSearchCond() {
    }

    public ItemSearchCond(String itemName, Integer maxPrice) {
        this.itemName = itemName;
        this.maxPrice = maxPrice;
    }
}
```

- ê²€ìƒ‰ ì¡°ê±´ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤. ìƒí’ˆëª…, ìµœëŒ€ ê°€ê²©ì´ ìˆë‹¤. ì°¸ê³ ë¡œ ìƒí’ˆëª…ì˜ ì¼ë¶€ë§Œ í¬í•¨ë˜ì–´ë„ ê²€ìƒ‰ì´ ê°€ëŠ¥í•´ì•¼í•œë‹¤. (`like` ê²€ìƒ‰)
- `cond` â†’ `condition` ì„ ì¤„ì—¬ì„œ ì‚¬ìš©í–ˆë‹¤.
    - ì´ í”„ë¡œì íŠ¸ì—ì„œ ê²€ìƒ‰ ì¡°ê±´ì€ ë’¤ì— `Cond`ë¥¼ ë¶™ì´ë„ë¡ ê·œì¹™ì„ ì •í–ˆë‹¤.

**ItemUpdateDto**

```java
package hello.itemservice.repository;

import lombok.Data;

@Data
public class ItemUpdateDto {
    private String itemName;
    private Integer price;
    private Integer quantity;

    public ItemUpdateDto() {
    }

    public ItemUpdateDto(String itemName, Integer price, Integer quantity) {
        this.itemName = itemName;
        this.price = price;
        this.quantity = quantity;
    }
}
```

- ìƒí’ˆì„ ìˆ˜ì •í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ê°ì²´ì´ë‹¤.
- ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©ë˜ë¯€ë¡œ DTOë¥¼ ë’¤ì— ë¶™ì˜€ë‹¤.

**DTO(data transfer object)**

- ë°ì´í„° ì „ì†¡ ê°ì²´
- DTOëŠ” ê¸°ëŠ¥ì€ ì—†ê³  ë°ì´í„°ë¥¼ ì „ë‹¬ë§Œ í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©ë˜ëŠ” ê°ì²´ë¥¼ ëœ»í•œë‹¤.
    - ì°¸ê³ ë¡œ DTOì— ê¸°ëŠ¥ì´ ìˆìœ¼ë©´ ì•ˆë˜ëŠ”ê°€? ê·¸ê²ƒì€ ì•„ë‹ˆë‹¤. ê°ì²´ì˜ ì£¼ ëª©ì ì´ ë°ì´í„°ë¥¼ ì „ì†¡í•˜ëŠ” ê²ƒì´ë¼ë©´ DTOë¼ í•  ìˆ˜ ìˆë‹¤.
- ê°ì²´ ì´ë¦„ì— DTOë¥¼ ê¼­ ë¶™ì—¬ì•¼ í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤. ëŒ€ì‹  ë¶™ì—¬ë‘ë©´ ìš©ë„ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì€ ìˆë‹¤.
- ì´ì „ì— ì„¤ëª…í•œ `ItemSearchCond`ë„ DTO ì—­í• ì„ í•˜ì§€ë§Œ, ì´ í”„ë¡œì íŠ¸ì—ì„œ `Cond`ëŠ” ê²€ìƒ‰ ì¡°ê±´ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤ëŠ” ê·œì¹™ì„ ì •í–ˆë‹¤. ë”°ë¼ì„œ DTOë¥¼ ë¶™ì´ì§€ ì•Šì•„ë„ ëœë‹¤. `ItemSearchCondDto` ì´ë ‡ê²Œ í•˜ë©´ ë„ˆë¬´ ë³µì¡í•´ì§„ë‹¤. ê·¸ë¦¬ê³  `Cond`ë¼ëŠ” ê²ƒë§Œ ë´ë„ ìš©ë„ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.
- ì°¸ê³ ë¡œ ì´ëŸ° ê·œì¹™ì€ ì •í•´ì§„ ê²ƒì´ ì—†ê¸° ë•Œë¬¸ì— í•´ë‹¹ í”„ë¡œì íŠ¸ ì•ˆì—ì„œ ì¼ê´€ì„± ìˆê²Œ ê·œì¹™ì„ ì •í•˜ë©´ ëœë‹¤.

**MemberItemRepository**

```java
package hello.itemservice.repository.memory;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import org.springframework.stereotype.Repository;
import org.springframework.util.ObjectUtils;

import java.util.*;
import java.util.stream.Collectors;

@Repository
public class MemoryItemRepository implements ItemRepository {

    private static final Map<Long, Item> store = new HashMap<>(); //static
    private static long sequence = 0L; //static

    @Override
    public Item save(Item item) {
        item.setId(++sequence);
        store.put(item.getId(), item);
        return item;
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        Item findItem = findById(itemId).orElseThrow();
        findItem.setItemName(updateParam.getItemName());
        findItem.setPrice(updateParam.getPrice());
        findItem.setQuantity(updateParam.getQuantity());
    }

    @Override
    public Optional<Item> findById(Long id) {
        return Optional.ofNullable(store.get(id));
    }

    @Override
    public List<Item> findAll(ItemSearchCond cond) {
        String itemName = cond.getItemName();
        Integer maxPrice = cond.getMaxPrice();
        return store.values().stream()
                .filter(item -> {
                    if (ObjectUtils.isEmpty(itemName)) {
                        return true;
                    }
                    return item.getItemName().contains(itemName);
                }).filter(item -> {
                    if (maxPrice == null) {
                        return true;
                    }
                    return item.getPrice() <= maxPrice;
                })
                .collect(Collectors.toList());
    }

    public void clearStore() {
        store.clear();
    }

}
```

- `ItemRepository` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ë©”ëª¨ë¦¬ ì €ì¥ì†Œì´ë‹¤.
- ë©”ëª¨ë¦¬ì´ê¸° ë•Œë¬¸ì— ìë°”ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë©´ ê¸°ì¡´ì— ì €ì¥ëœ ë°ì´í„°ê°€ ëª¨ë‘ ì‚¬ë¼ì§„ë‹¤.
- `save`, `update`, `findById`ëŠ” ì‰½ê²Œ ì´í•´í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ì°¸ê³ ë¡œ `findById`ëŠ” `Optional`ì„ ë°˜í™˜í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— `Optional.ofNullable`ì„ ì‚¬ìš©í–ˆë‹¤.
- `findAll`ì€ `ItemSearchCond`ì´ë¼ëŠ” ê²€ìƒ‰ ì¡°ê±´ì„ ë°›ì•„ì„œ ë‚´ë¶€ì—ì„œ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥ì„ í•œë‹¤.
    
    ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë³´ë©´ `where` êµ¬ë¬¸ì„ ì‚¬ìš©í•´ì„œ í•„ìš”í•œ ë°ì´í„°ë¥¼ í•„í„°ë§ í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹˜ëŠ” ê²ƒì´ë‹¤.
    
    - ì—¬ê¸°ì„œ ìë°” ìŠ¤í¬ë¦¼ì„ ì‚¬ìš©í•œë‹¤.
    - `itemName`ì´ë‚˜, `maxPrice`ê°€ `null`ì´ê±°ë‚˜ ë¹„ì—ˆìœ¼ë©´ í•´ë‹¹ ì¡°ê±´ì„ ë¬´ì‹œí•œë‹¤.
    - `itemName`ì´ë‚˜, `maxPrice`ì— ê°’ì´ ìˆì„ ë•Œë§Œ í•´ë‹¹ ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œë‹¤.
- `clearStore()` ë©”ëª¨ë¦¬ì— ì €ì¥ëœ `Item`ì„ ëª¨ë‘ ì‚­ì œí•´ì„œ ì´ˆê¸°í™”í•œë‹¤. í…ŒìŠ¤íŠ¸ ìš©ë„ë¡œë§Œ ì‚¬ìš©í•œë‹¤.

### ì„œë¹„ìŠ¤ ë¶„ì„

**ItemService ì¸í„°í˜ì´ìŠ¤**

```java
package hello.itemservice.service;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;

import java.util.List;
import java.util.Optional;

public interface ItemService {

    Item save(Item item);

    void update(Long itemId, ItemUpdateDto updateParam);

    Optional<Item> findById(Long id);

    List<Item> findItems(ItemSearchCond itemSearch);
}
```

- ì„œë¹„ìŠ¤ì˜ êµ¬í˜„ì²´ë¥¼ ì‰½ê²Œ ë³€ê²½í•˜ê¸° ìœ„í•´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í–ˆë‹¤.
- ì°¸ê³ ë¡œ ì„œë¹„ìŠ¤ëŠ” êµ¬í˜„ì²´ë¥¼ ë³€ê²½í•  ì¼ì´ ë§ì§€ëŠ” ì•Šê¸° ë•Œë¬¸ì— ì‚¬ì‹¤ ì„œë¹„ìŠ¤ì— ì¸í„°í˜ì´ìŠ¤ë¥¼ ì˜ ë„ì…í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤.
    - ì—¬ê¸°ì„œëŠ” ì˜ˆì œ ì„¤ëª… ê³¼ì •ì—ì„œ êµ¬í˜„ì²´ë¥¼ ë³€ê²½í•  ì˜ˆì •ì´ì–´ì„œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë„ì…í–ˆë‹¤.

**ItemServiceV1**

```java
package hello.itemservice.service;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;

@Service
@RequiredArgsConstructor
public class ItemServiceV1 implements ItemService {

    private final ItemRepository itemRepository;

    @Override
    public Item save(Item item) {
        return itemRepository.save(item);
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        itemRepository.update(itemId, updateParam);
    }

    @Override
    public Optional<Item> findById(Long id) {
        return itemRepository.findById(id);
    }

    @Override
    public List<Item> findItems(ItemSearchCond cond) {
        return itemRepository.findAll(cond);
    }
}
```

- `ItemServiceV1` ì„œë¹„ìŠ¤ êµ¬í˜„ì²´ëŠ” ëŒ€ë¶€ë¶„ì˜ ê¸°ëŠ¥ì„ ë‹¨ìˆœíˆ ë¦¬í¬ì§€í† ë¦¬ì— ìœ„ì„í•œë‹¤.

### ì»¨íŠ¸ë¡¤ëŸ¬ ë¶„ì„

**HomeController**

```java
package hello.itemservice.web;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;

@Controller
@RequiredArgsConstructor
public class HomeController {

    @RequestMapping("/")
    public String home() {
        return "redirect:/items";
    }
}
```

- ë‹¨ìˆœíˆ í™ˆìœ¼ë¡œ ìš”ì²­ì´ ì™”ì„ ë•Œ `items`ë¡œ ì´ë™í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì´ë‹¤.

**ItemController**

```java
package hello.itemservice.web;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import hello.itemservice.service.ItemService;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;

import java.util.List;

@Controller
@RequestMapping("/items")
@RequiredArgsConstructor
public class ItemController {

    private final ItemService itemService;

    @GetMapping
    public String items(@ModelAttribute("itemSearch") ItemSearchCond itemSearch, Model model) {
        List<Item> items = itemService.findItems(itemSearch);
        model.addAttribute("items", items);
        return "items";
    }

    @GetMapping("/{itemId}")
    public String item(@PathVariable long itemId, Model model) {
        Item item = itemService.findById(itemId).get();
        model.addAttribute("item", item);
        return "item";
    }

    @GetMapping("/add")
    public String addForm() {
        return "addForm";
    }

    @PostMapping("/add")
    public String addItem(@ModelAttribute Item item, RedirectAttributes redirectAttributes) {
        Item savedItem = itemService.save(item);
        redirectAttributes.addAttribute("itemId", savedItem.getId());
        redirectAttributes.addAttribute("status", true);
        return "redirect:/items/{itemId}";
    }

    @GetMapping("/{itemId}/edit")
    public String editForm(@PathVariable Long itemId, Model model) {
        Item item = itemService.findById(itemId).get();
        model.addAttribute("item", item);
        return "editForm";
    }

    @PostMapping("/{itemId}/edit")
    public String edit(@PathVariable Long itemId, @ModelAttribute ItemUpdateDto updateParam) {
        itemService.update(itemId, updateParam);
        return "redirect:/items/{itemId}";
    }

}
```

- ìƒí’ˆì„ CRUDí•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì´ë‹¤. ìì„¸í•œ ë‚´ìš©ì€ MVC1í¸ì„ ì°¸ê³ í•˜ì.
- í™”ë©´ì„ ì¶œë ¥í•˜ê¸° ìœ„í•œ ë¦¬ì†ŒìŠ¤(`css`, `html`, `templates`)ëŠ” MVC1í¸ì„ ì°¸ê³ í•˜ì.

## í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ëª…2 - ì„¤ì •

### ìŠ¤í”„ë§ ë¶€íŠ¸ ì„¤ì • ë¶„ì„

**MemoryConfig**

```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.memory.MemoryItemRepository;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class MemoryConfig {

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new MemoryItemRepository();
    }

}
```

- ItemServiceV1, MemoryItemRepositoryë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê³  ìƒì„±ìë¥¼ í†µí•´ ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…í•œë‹¤.
- ì°¸ê³ ë¡œ ì—¬ê¸°ì„œëŠ” ì„œë¹„ìŠ¤ì™€ ë¦¬í¬ì§€í† ë¦¬ëŠ” êµ¬í˜„ì²´ë¥¼ í¸ë¦¬í•˜ê²Œ ë³€ê²½í•˜ê¸° ìœ„í•´, ì´ë ‡ê²Œ ìˆ˜ë™ìœ¼ë¡œ ë¹ˆì„ ë“±ë¡í–ˆë‹¤.
- ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ ì‚¬ìš©í•œë‹¤.

**TestDataInit**

```java
package hello.itemservice;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.context.event.ApplicationReadyEvent;
import org.springframework.context.event.EventListener;

@Slf4j
@RequiredArgsConstructor
public class TestDataInit {

    private final ItemRepository itemRepository;

    /**
     * í™•ì¸ìš© ì´ˆê¸° ë°ì´í„° ì¶”ê°€
     */
    @EventListener(ApplicationReadyEvent.class)
    public void initData() {
        log.info("test data init");
        itemRepository.save(new Item("itemA", 10000, 10));
        itemRepository.save(new Item("itemB", 20000, 20));
    }

}
```

- ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•  ë•Œ ì´ˆê¸° ë°í‹°ì–´ë¥¼ ì €ì¥í•œë‹¤.
- ë¦¬ìŠ¤íŠ¸ì—ì„œ ë°ì´í„°ê°€ ì˜ ë‚˜ì˜¤ëŠ”ì§€ í¸ë¦¬í•˜ê²Œ í™•ì¸í•  ìš©ë„ë¡œ ì‚¬ìš©í•œë‹¤.
    - ì´ ê¸°ëŠ¥ì´ ì—†ìœ¼ë©´ ì„œë²„ë¥¼ ì‹¤í–‰í•  ë•Œ ë§ˆë‹¤ ë°ì´í„°ë¥¼ ì…ë ¥í•´ì•¼ ë¦¬ìŠ¤íŠ¸ì— ë‚˜íƒ€ë‚œë‹¤. (ë©”ëª¨ë¦¬ì—¬ì„œ ì„œë²„ë¥¼ ë‚´ë¦¬ë©´ ë°ì´í„°ê°€ ì œê±°ëœë‹¤.)
- `@EvenListener(ApplicationReadyEvetn.class)` : ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì™„ì „íˆ ì´ˆê¸°í™”ë¥¼ ë‹¤ ëë‚´ê³ , ì‹¤í–‰ ì¤€ë¹„ê°€ ë˜ì—ˆì„ ë•Œ ë°œìƒí•˜ëŠ” ì´ë²¤íŠ¸ì´ë‹¤. ìŠ¤í”„ë§ì´ ì´ ì‹œì ì— í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ `initData()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì¤€ë‹¤.
    - ì°¸ê³ ë¡œ ì´ ê¸°ëŠ¥ ëŒ€ì‹  `@PoatConstruct`ë¥¼ ì‚¬ìš©í•  ê²½ìš° AOP ê°™ì€ ë¶€ë¶„ì´ ì•„ì§ ë‹¤ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì‹œì ì— í˜¸ì¶œë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ê°„í˜¹ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ `@Transactional`ê³¼ ê´€ë ¨ëœ AOPê°€ ì ìš©ë˜ì§€ ì•Šì€ ìƒíƒœë¡œ í˜¸ì¶œë  ìˆ˜ ìˆë‹¤.
    - `@EventListener(ApplicationReadyEvent.class)`ëŠ” AOPë¥¼ í¬í•¨í•œ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì™„ì „íˆ ì´ˆê¸°í™” ëœ ì´í›„ì— í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— ì´ëŸ° ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

**ItemServiceApplication**

```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;

@Import(MemoryConfig.class)
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

	@Bean
	@Profile("local")
	public TestDataInit testDataInit(ItemRepository itemRepository) {
		return new TestDataInit(itemRepository);
	}

}
```

- `@Import(MemoryConfig.class)` : ì•ì„œ ì„¤ì •í•œ `MemoryConfig`ë¥¼ ì„¤ì • íŒŒì¼ë¡œ ì‚¬ìš©í•œë‹¤.
- `scanBasePackages = â€œhello.itemservice.webâ€` : ì—¬ê¸°ì„œëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ë§Œ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ ì‚¬ìš©í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ì§ì ‘ ìˆ˜ë™ ë“±ë¡í•œë‹¤. ê·¸ë˜ì„œ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº” ê²½ë¡œë¥¼ `hello.itemservice.web` í•˜ìœ„ë¡œ ì§€ì •í–ˆë‹¤.
- `@Profile(â€localâ€)` : íŠ¹ì • í”„ë¡œí•„ì˜ ê²½ìš°ì—ë§Œ í•´ë‹¹ ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•œë‹¤. ì—¬ê¸°ì„œëŠ” `local`ì´ë¼ëŠ” ì´ë¦„ì˜ í”„ë¡œí•„ì´ ì‚¬ìš©ë˜ëŠ” ê²½ìš°ì—ë§Œ `testDataInit`ì´ë¼ëŠ” ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•œë‹¤. ì´ ë¹ˆì€ ì•ì„œ ë³¸ ê²ƒì¸ë°, í¸ì˜ìƒ ì´ˆê¸° ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì„œ ì €ì¥í•˜ëŠ” ë¹ˆì´ë‹¤.

### í”„ë¡œí•„

ìŠ¤í”„ë§ì€ ë¡œë”© ì‹œì ì— `application.properties`ì˜ `spring.profiles.active` ì†ì„±ì„ ì½ì–´ì„œ í”„ë¡œí•„ë¡œ ì‚¬ìš©í•œë‹¤.

ì´ í”„ë¡œí•„ì€ ë¡œì»¬(ë‚˜ì˜ PC), ìš´ì˜ í™˜ê²½, í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë“±ë“± ë‹¤ì–‘í•œ í™˜ê²½ì— ë”°ë¼ì„œ ë‹¤ë¥¸ ì„¤ì •ì„ í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì •ë³´ì´ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ì„œ ë¡œì»¬PCì—ì„œëŠ” ë¡œì»¬ PCì— ì„¤ì¹˜ëœ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•´ì•¼ í•˜ê³ , ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ìš´ì˜ ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•´ì•¼ í•œë‹¤ë©´ ì„œë¡œ ì„¤ì • ì •ë³´ê°€ ë‹¬ë¼ì•¼ í•œë‹¤. ì‹¬ì§€ì–´ í™˜ê²½ì— ë”°ë¼ì„œ ë‹¤ë¥¸ ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í•´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤. í”„ë¡œí•„ì„ ì‚¬ìš©í•˜ë©´ ì´ëŸ° ë¬¸ì œë¥¼ ê¹”ë”í•˜ê²Œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

**main í”„ë¡œí•„**

`/src/main/resources` í•˜ìœ„ì˜ `application.properties`

```java
spring.profiles.active=local
```

- ì´ ìœ„ì¹˜ì˜ `application.properties`ëŠ” `/src/main` í•˜ìœ„ì˜ ìë°” ê°ì²´ë¥¼ ì‹¤í–‰í•  ë•Œ (ì£¼ë¡œ `main()`) ë™ì‘í•˜ëŠ” ìŠ¤í”„ë§ ì„¤ì •ì´ë‹¤. `spring.profiles.active=local`ì´ë¼ê³  í•˜ë©´ ìŠ¤í”„ë§ì€ `local`ì´ë¼ëŠ” í”„ë¡œí•„ë¡œ ë™ì‘í•œë‹¤. ë”°ë¼ì„œ ì§ì „ì— ì„¤ëª…í•œ `@Profile(â€localâ€)`ê°€ ë™ì‘í•˜ê³ , `testDataInit`ê°€ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœë‹¤.

ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```java
The following 1 profile is active: "local"
```

ì°¸ê³ ë¡œ í”„ë¡œí•„ì„ ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ë””í´íŠ¸(default) í”„ë¡œí•„ì´ ì‹¤í–‰ëœë‹¤.

```java
No active profile set, falling back to 1 default profile: "default"
```

**test í”„ë¡œí•„**

`/src/test/resources` í•˜ìœ„ì˜ `application.properties`

```java
spring.profiles.active=test
```

- ì´ ìœ„ì¹˜ì˜ `application.properties`ëŠ” `/src/test` í•˜ìœ„ì˜ ìë°” ê°ì²´ë¥¼ ì‹¤í–‰í•  ë•Œ ë™ì‘í•˜ëŠ” ìŠ¤í”„ë§ ì„¤ì •ì´ë‹¤.
- ì£¼ë¡œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‹¤í–‰í•  ë•Œ ë™ì‘í•œë‹¤.
- `spring.profiles.active=test` ë¡œ ì„¤ì •í•˜ë©´ ìŠ¤í”„ë§ì€ `test` ë¼ëŠ” í”„ë¡œí•„ë¡œ ë™ì‘í•œë‹¤. ì´ ê²½ìš° ì§ì „ì— ì„¤ëª…í•œ `@Profile(â€localâ€)`ëŠ” í”„ë¡œí•„ ì •ë³´ê°€ ë§ì§€ ì•Šì•„ì„œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤. ë”°ë¼ì„œ `testDataInit`ì´ë¼ëŠ” ìŠ¤í”„ë§ ë¹ˆë„ ë“±ë¡ë˜ì§€ ì•Šê³ , ì´ˆê¸° ë°ì´í„°ë„ ì¶”ê°€í•˜ì§€ ì•ŠëŠ”ë‹¤.

```java
The following 1 profile is active: "test"
```

- í”„ë¡œí•„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ ìŠ¤í”„ë§ìœ¼ë¡œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¡œì»¬(local)ì—ì„œ ì§ì ‘ ì‹¤í–‰í•  ë•ŒëŠ” testDataInitì´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ëœë‹¤. ë”°ë¼ì„œ ë“±ë¡í•œ ì´ˆê¸°í™” ë°ì´í„°ë¥¼ í¸ë¦¬í•˜ê²Œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- ì´ˆê¸°í™” ë°ì´í„° ë•ë¶„ì— í¸ë¦¬í•œ ì ë„ ìˆì§€ë§Œ, í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ì‹¤í–‰í•  ë•ŒëŠ” ë¬¸ì œê°€ ë  ìˆ˜ ìˆë‹¤. í…ŒìŠ¤íŠ¸ì—ì„œ ì´ëŸ° ë°ì´í„°ê°€ ë“¤ì–´ìˆë‹¤ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ë°ì´í„°ë¥¼ í•˜ë‚˜ ì €ì¥í•˜ê³  ì „ì²´ ì¹´ìš´íŠ¸ë¥¼ í™•ì¸í•˜ëŠ”ë° 1ì´ ì•„ë‹ˆë¼ testDataInit ë•Œë¬¸ì— ë°ì´í„°ê°€ 2ê±´ ì¶”ê°€ë˜ì–´ì„œ 3ì´ ë˜ëŠ” ê²ƒì´ë‹¤.
- í”„ë¡œí•„ ê¸°ëŠ¥ ë•ë¶„ì— í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ì—ì„œëŠ” test í”„ë¡œí•„ì´ ì‹¤í–‰ëœë‹¤. ë”°ë¼ì„œ TestDataInitëŠ” ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ì¶”ê°€ë˜ì§€ ì•Šê³ , ë”°ë¼ì„œ ì´ˆê¸° ë°ì´í„°ë„ ì¶”ê°€ë˜ì§€ ì•ŠëŠ”ë‹¤.

> ğŸ’¡Â ì°¸ê³ 
> 

í”„ë¡œí•„ì— ëŒ€í•œ ìŠ¤í”„ë§ ë¶€íŠ¸ ê³µì‹ ë©”ë‰´ì–¼ì€ ë‹¤ìŒì„ ì°¸ê³ í•˜ì.

[Core Features](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.profiles)

## í”„ë¡œì íŠ¸ êµ¬ì¡° ì„¤ëª…3 - í…ŒìŠ¤íŠ¸

**ItemRepositoryTest**

```java
package hello.itemservice.domain;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import hello.itemservice.repository.memory.MemoryItemRepository;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;

@SpringBootTest
class ItemRepositoryTest {

    @Autowired
    ItemRepository itemRepository;

    @AfterEach
    void afterEach() {
        //MemoryItemRepository ì˜ ê²½ìš° ì œí•œì ìœ¼ë¡œ ì‚¬ìš©
        if (itemRepository instanceof MemoryItemRepository) {
            ((MemoryItemRepository) itemRepository).clearStore();
        }
    }

    @Test
    void save() {
        //given
        Item item = new Item("itemA", 10000, 10);

        //when
        Item savedItem = itemRepository.save(item);

        //then
        Item findItem = itemRepository.findById(item.getId()).get();
        assertThat(findItem).isEqualTo(savedItem);
    }

    @Test
    void updateItem() {
        //given
        Item item = new Item("item1", 10000, 10);
        Item savedItem = itemRepository.save(item);
        Long itemId = savedItem.getId();

        //when
        ItemUpdateDto updateParam = new ItemUpdateDto("item2", 20000, 30);
        itemRepository.update(itemId, updateParam);

        //then
        Item findItem = itemRepository.findById(itemId).get();
        assertThat(findItem.getItemName()).isEqualTo(updateParam.getItemName());
        assertThat(findItem.getPrice()).isEqualTo(updateParam.getPrice());
        assertThat(findItem.getQuantity()).isEqualTo(updateParam.getQuantity());
    }

    @Test
    void findItems() {
        //given
        Item item1 = new Item("itemA-1", 10000, 10);
        Item item2 = new Item("itemA-2", 20000, 20);
        Item item3 = new Item("itemB-1", 30000, 30);

        itemRepository.save(item1);
        itemRepository.save(item2);
        itemRepository.save(item3);

        //ë‘˜ ë‹¤ ì—†ìŒ ê²€ì¦
        test(null, null, item1, item2, item3);
        test("", null, item1, item2, item3);

        //itemName ê²€ì¦
        test("itemA", null, item1, item2);
        test("temA", null, item1, item2);
        test("itemB", null, item3);

        //maxPrice ê²€ì¦
        test(null, 10000, item1);

        //ë‘˜ ë‹¤ ìˆìŒ ê²€ì¦
        test("itemA", 10000, item1);
    }

    void test(String itemName, Integer maxPrice, Item... items) {
        List<Item> result = itemRepository.findAll(new ItemSearchCond(itemName, maxPrice));
        assertThat(result).containsExactly(items);
    }
}
```

- `afterEach` : í…ŒìŠ¤íŠ¸ëŠ” ì„œë¡œ ì˜í–¥ì„ ì£¼ë©´ ì•ˆëœë‹¤. ë”°ë¼ì„œ ê°ê°ì˜ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ê³  ë‚˜ë©´ ì €ì¥í•œ ë°ì´í„°ë¥¼ ì œê±°í•´ì•¼ í•œë‹¤. `@AfterEach`ëŠ” ê°ê°ì˜ í…ŒìŠ¤íŠ¸ì˜ ì‹¤í–‰ì´ ëë‚˜ëŠ” ì‹œì ì— í˜¸ì¶œëœë‹¤. ì—¬ê¸°ì„œëŠ” ë©”ëª¨ë¦¬ ì €ì¥ì†Œë¥¼ ì™„ì „íˆ ì‚­ì œí•´ì„œ ë‹¤ìŒ í…ŒìŠ¤íŠ¸ì— ì˜í–¥ì„ ì£¼ì§€ ì•Šë„ë¡ ì´ˆê¸°í™” í•œë‹¤.
- ì¸í„°í˜ì´ìŠ¤ì—ëŠ” `clearStore()`ê°€ ì—†ê¸° ë•Œë¬¸ì— `MemoryItemRepository`ì¸ ê²½ìš°ì—ë§Œ ë‹¤ìš´ ìºìŠ¤íŒ…ì„ í•´ì„œ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•œë‹¤. ì‹¤ì œ DBë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” í…ŒìŠ¤íŠ¸ê°€ ëë‚œ í›„ì— íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•´ì„œ ë°ì´í„°ë¥¼ ì´ˆê¸°í™” í•  ìˆ˜ ìˆë‹¤.
- `save()` : ìƒí’ˆì„ í•˜ë‚˜ ì €ì¥í•˜ê³  ì˜ ì €ì¥ë˜ì—ˆëŠ”ì§€ ê²€ì¦í•œë‹¤.
- `updateItem()` : ìƒí’ˆì„ í•˜ë‚˜ ìˆ˜ì •í•˜ê³  ì˜ ìˆ˜ì •ë˜ì—ˆëŠ”ì§€ ê²€ì¦í•œë‹¤.
- `findItems()` : ìƒí’ˆì„ ì°¾ëŠ” í…ŒìŠ¤íŠ¸ì´ë‹¤.
    - ìƒí’ˆëª…ê³¼ ìƒí’ˆ ê°€ê²© ì¡°ê±´ì„ ë‹¤ì–‘í•˜ê²Œ ë¹„êµí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
    - ë¬¸ìì˜ ê²½ìš° `null` ì¡°ê±´ë„ ìˆì§€ë§Œ, ë¹ˆ ë¬¸ì(`â€â€`)ì˜ ê²½ìš°ì—ë„ ì˜ ë™ì‘í•˜ëŠ”ì§€ ê²€ì¦í•œë‹¤.

> **ì¸í„°í˜ì´ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ì**
ì—¬ê¸°ì„œëŠ” `MemoryItemRepository` êµ¬í˜„ì²´ë¥¼ í…ŒìŠ¤íŠ¸ í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ `ItemRepository` ì¸í„°í˜ì´ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ì¸í„°í˜ì´ìŠ¤ë¥¼ ëŒ€ìƒìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ë©´ í–¥í›„ ë‹¤ë¥¸ êµ¬í˜„ì²´ë¡œ ë³€ê²½ë˜ì—ˆì„ ë•Œ í•´ë‹¹ êµ¬í˜„ì²´ê°€ ì˜ ë™ì‘í•˜ëŠ”ì§€ ê°™ì€ í…ŒìŠ¤íŠ¸ë¡œ í¸ë¦¬í•˜ê²Œ ê²€ì¦í•  ìˆ˜ ìˆë‹¤.
> 

## ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” ìƒì„±

ì´ì œë¶€í„° ë‹¤ì–‘í•œ ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ ë“¤ì„ í™œìš©í•´ì„œ ë©”ëª¨ë¦¬ê°€ ì•„ë‹Œ ë°ì´í„°ë² ì´ìŠ¤ì— ë°ì´í„°ë¥¼ ë³´ê´€í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì.

ë¨¼ì € H2 ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•´ì„œ `item` í…Œì´ë¸”ì„ ìƒì„±í•˜ì.

```sql
drop table if exists item CASCADE;
create table item
(
   id        bigint generated by default as identity,
   item_name varchar(10),
   price     integer,
   quantity  integer,
   primary key (id)
);
```

- `generated by default as identity`
    - `identidy` ì „ëµì´ê³  í•˜ëŠ”ë°, ê¸°ë³¸ í‚¤ ìƒì„±ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ìœ„ì„í•˜ëŠ” ë°©ë²•ì´ë‹¤. MySQLì˜ AutoIncrementì™€ ê°™ì€ ë°©ë²•ì´ë‹¤.
    - ì—¬ê¸°ì„œ PKë¡œ ì‚¬ìš©ë˜ëŠ” `id`ëŠ” ê°œë°œìê°€ ì§ì ‘ ì§€ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë¹„ì›Œë‘ê³  ì €ì¥í•˜ë©´ ëœë‹¤. ê·¸ëŸ¬ë©´ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìˆœì„œëŒ€ë¡œ ì¦ê°€í•˜ëŠ” ê°’ì„ ì‚¬ìš©í•´ì„œ ë„£ì–´ì¤€ë‹¤.
    

í…Œì´ë¸”ì— ìƒì„±í–ˆìœ¼ë©´, ì˜ ë™ì‘í•˜ëŠ”ì§€ ë‹¤ìŒ SQLì„ ì‹¤í–‰í•˜ê³  ì¡°íšŒí•´ë³´ì.

**ë“±ë¡ ì¿¼ë¦¬**

```sql
insert into item(item_name, price, quantity) values ('ItemTest', 10000, 10)
```

**ì¡°íšŒ ì¿¼ë¦¬**

```sql
select * from item;
```

- ì‹¤í–‰í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒì„±í•œ `id`ê°’ì„ í¬í•¨í•´ì„œ ë“±ë¡í•œ ë°ì´í„°ê°€ ì˜ ì €ì¥ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

### ğŸ’¡Â ì°¸ê³  - ê¶Œì¥í•˜ëŠ” ì‹ë³„ì ì„ íƒ ì „ëµ

**ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë³¸ í‚¤ëŠ” ë‹¤ìŒ 3ê°€ì§€ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•´ì•¼ í•œë‹¤.**

1. nullê°’ì€ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
2. ìœ ì¼í•´ì•¼ í•œë‹¤.
3. ë³€í•´ì„  ì•ˆ ëœë‹¤.

**í…Œì´ë¸”ì˜ ê¸°ë³¸ í‚¤ë¥¼ ì„ íƒí•˜ëŠ” ì „ëµì€ í¬ê²Œ 2ê°€ì§€ê°€ ìˆë‹¤.**

- ìì—° í‚¤(natural key)
    - ë¹„ì¦ˆë‹ˆìŠ¤ì— ì˜ë¯¸ê°€ ìˆëŠ” í‚¤
    - ì˜ˆ : ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸, ì´ë©”ì¼, ì „í™”ë²ˆí˜¸
- ëŒ€ëµ í‚¤(surrogate key)
    - ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ê´€ë ¨ ì—†ëŠ” ì„ì˜ë¡œ ë§Œë“¤ì–´ì§„ í‚¤, ëŒ€ì²´ í‚¤ë¡œë„ ë¶ˆë¦°ë‹¤.
    - ì˜ˆ : ì˜¤ë¼í´ ì‹œí€€ìŠ¤, auto_increment, identity, í‚¤ìƒì„± í…Œì´ë¸” ì‚¬ìš©

**ìì—° í‚¤ë³´ë‹¤ëŠ” ëŒ€ë¦¬ í‚¤ë¥¼ ê¶Œì¥í•œë‹¤.**

ìì—° í‚¤ì™€ ëŒ€ë¦¬ í‚¤ëŠ” ì¼ì¥ ì¼ë‹¨ì´ ìˆì§€ë§Œ ë  ìˆ˜ ìˆìœ¼ë©´ ëŒ€ë¦¬ í‚¤ì˜ ì‚¬ìš©ì„ ê¶Œì¥í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ìì—° í‚¤ì¸ ì „í™”ë²ˆí˜¸ë¥¼ ê¸°ë³¸ í‚¤ë¡œ ì„ íƒí•œë‹¤ë©´ ê·¸ ë²ˆí˜¸ê°€ ìœ ì¼í•  ìˆ˜ëŠ” ìˆì§€ë§Œ, ì „í™”ë²ˆí˜¸ê°€ ì—†ì„ ìˆ˜ë„ ìˆê³  ì „í™”ë²ˆí˜¸ê°€ ë³€ê²½ë  ìˆ˜ë„ ìˆë‹¤. ë”°ë¼ì„œ ê¸°ë³¸ í‚¤ë¡œ ì ë‹¹í•˜ì§€ ì•Šë‹¤. ë¬¸ì œëŠ” ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ì²˜ëŸ¼ ê·¸ëŸ´ë“¯í•˜ê²Œ ë³´ì´ëŠ” ê°’ì´ë‹¤. 

ã…‡ã…£ ê°’ì€ `null`ì´ ì•„ë‹ˆê³  ìœ ì¼í•˜ë©° ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” 3ê°€ì§€ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” ê²ƒ ê°™ë‹¤. í•˜ì§€ë§Œ í˜„ì‹¤ê³¼ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì€ ìƒê°ë³´ë‹¤ ì‰½ê²Œ ë³€í•œë‹¤. ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ ì¡°ì°¨ë„ ì—¬ëŸ¬ ê°€ì§€ ì´ìœ ë¡œ ë³€ê²½ë  ìˆ˜ ìˆë‹¤.

**ë¹„ì¦ˆë‹ˆìŠ¤ í™˜ê²½ì€ ì–¸ì œë‚˜ ë³€í•œë‹¤.**

íšŒì› í…Œì´ë¸”ì— ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ê°€ ê¸°ë³¸ í‚¤ë¡œ ì¡í˜€ ìˆì—ˆë‹¤.

íšŒì›ê³¼ ê´€ë ¨ëœ ìˆ˜ë§ì€ í…Œì´ë¸”ì—ì„œ ì¡°ì¸ì„ ìœ„í•´ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë¥¼ ì™¸ë˜ í‚¤ë¡œ ê°€ì§€ê³  ìˆì—ˆê³  ì‹¬ì§€ì–´ ìì‹ í…Œì´ë¸”ì˜ ìì‹ í…Œì´ë¸”ê¹Œì§€ ì£¼ë¯¼ë“±ë¡ ë²ˆí˜¸ê°€ ë‚´ë ¤ê°€ ìˆì—ˆë‹¤. ë¬¸ì œëŠ” ì •ë¶€ ì •ì±…ì´ ë³€ê²½ë˜ë©´ì„œ ë²•ì ìœ¼ë¡œ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ê²Œ ë˜ë©´ì„œ ë°œìƒí–ˆë‹¤. ê²°êµ­ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì€ ë¬¼ë¡ ì´ê³  ìˆ˜ë§ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì„ ìˆ˜ì •í–ˆë‹¤. ë§Œì•½ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì²˜ìŒ ì„¤ê³„í•  ë•Œë¶€í„° ìì—°í‚¤ì¸ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ ëŒ€ì‹ ì— ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ê´€ë ¨ ì—†ëŠ” ëŒ€ë¦¬ í‚¤ë¥¼ ì‚¬ìš©í–ˆë‹¤ë©´ ìˆ˜ì •í•  ë¶€ë¶„ì´ ë§ì§€ëŠ” ì•Šì•˜ì„ ê²ƒì´ë‹¤.

ê¸°ë³¸ í‚¤ì˜ ì¡°ê±´ì„ í˜„ì¬ëŠ” ë¬¼ë¡ ì´ê³  ë¯¸ë˜ê¹Œì§€ ì¶©ì¡±í•˜ëŠ” ìì—° í‚¤ë¥¼ ì°¾ê¸°ëŠ” ì‰½ì§€ ì•Šë‹¤. ëŒ€ë¦¬ í‚¤ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ì™€ ë¬´ê´€í•œ ì„ì˜ì˜ ê°’ì´ë¯€ë¡œ ìš”êµ¬ì‚¬í•­ì´ ë³€ê²½ë˜ì–´ë„ ê¸°ë³¸ í‚¤ê°€ ë³€ê²½ë˜ëŠ” ì¼ì€ ë“œë¬¼ë‹¤. ëŒ€ë¦¬ í‚¤ë¥¼ ê¸°ë³¸ í‚¤ë¡œ ì‚¬ìš©í•˜ë˜ ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ë‚˜ ì´ë©”ì¼ì²˜ëŸ¼ ìì—° í‚¤ì˜ í›„ë³´ê°€ ë˜ëŠ” ì»¬ëŸ¼ë“¤ì€ í•„ìš”ì— ë”°ë¼ ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ë¥¼ ì„¤ì •í•´ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤.

JPAëŠ” ëª¨ë“  ì—”í‹°í‹°ì— ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ ëŒ€ë¦¬ í‚¤ ì‚¬ìš©ì„ ê¶Œì¥í•œë‹¤.

ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì€ ê³„ì†í•´ì„œ ë³€í•˜ëŠ”ë° í…Œì´ë¸”ì€ í•œ ë²ˆ ì •ì˜í•˜ë©´ ë³€ê²½í•˜ê¸° ì–´ë µë‹¤. ê·¸ëŸ¬ë©´ì—ì„œ ì™¸ë¶€ í’íŒŒì— ì‰½ê²Œ í”ë“¤ë¦¬ì§€ ì•ŠëŠ” ëŒ€ë¦¬ í‚¤ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì¢‹ì€ ì„ íƒì´ë¼ ìƒê°í•œë‹¤.