# ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ  - ìŠ¤í”„ë§ JdbcTemplate

## JdbcTemplate ì†Œê°œì™€ ì„¤ì •

SQLì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì— ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” JdbcTemplateì€ ì•„ì£¼ ì¢‹ì€ ì„ íƒì§€ë‹¤. JdbcTemplateì€ JDBCë¥¼ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤.

### ì¥ì 

- ì„¤ì •ì˜ í¸ë¦¬í•¨
    - JdbcTemplateì€ spring-jdbc ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ë˜ì–´ ìˆëŠ”ë°, ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ìŠ¤í”„ë§ìœ¼ë¡œ JDBCë¥¼ ì‚¬ìš©í•  ë•Œ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤. ê·¸ë¦¬ê³  ë³„ë„ì˜ ë³µì¡í•œ ì„¤ì • ì—†ì´ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- ë°˜ë³µ ë¬¸ì œ í•´ê²°
    - JdbcTemplateì€ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì„ ì‚¬ìš©í•´ì„œ, JDBCë¥¼ ì§ì ‘ ì‚¬ìš©í•  ë•Œ ë°œìƒí•˜ëŠ” ëŒ€ë¶€ë¶„ì˜ ë°˜ë³µ ì‘ì—…ì„ ëŒ€ì‹  ì²˜ë¦¬í•´ì¤€ë‹¤.
    - ê°œë°œìëŠ” SQLì„ ì‘ì„±í•˜ê³ , ì „ë‹¬í•  íŒŒë¼ë¯¸í„°ë¥¼ ì •ì˜í•˜ê³ , ì‘ë‹µ ê°’ì„ ë§¤í•‘í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤.
    - ìš°ë¦¬ê°€ ìƒê°í•  ìˆ˜ ìˆëŠ” ëŒ€ë¶€ë¶„ì˜ ë°˜ë³µ ì‘ì—…ì„ ëŒ€ì‹  ì²˜ë¦¬í•´ì¤€ë‹¤.
        - ì»¤ë„¥ì…˜ íšë“
        - statementë¥¼ ì¤€ë¹„í•˜ê³  ì‹¤í–‰
        - ê²°ê³¼ë¥¼ ë°˜ë³µí•˜ë„ë¡ ë£¨í”„ë¥¼ ì‹¤í–‰
        - ì»¤ë„¥ì…˜ ì¢…ë£Œ, statement, resultset ì¢…ë£Œ
        - íŠ¸ëœì­ì…˜ ë‹¤ë¥´ê¸° ìœ„í•œ ì»¤ë„¥ì…˜ ë™ê¸°í™”
        - ì˜ˆì™¸ ë°œìƒì‹œ ìŠ¤í”„ë§ ì˜ˆì™¸ ë³€í™˜ê¸° ì‹¤í–‰

### ë‹¨ì 

- ë™ì  SQLì„ í•´ê²°í•˜ê¸° ì–´ë µë‹¤.

### JdbcTemplate ì„¤ì •

`build.gradle`

```
dependencies {

    implementation 'org.springframework.boot:spring-boot-starter-thymeleaf'
    implementation 'org.springframework.boot:spring-boot-starter-web'

		//JdbcTemplate ì¶”ê°€
		implementation 'org.springframework.boot:spring-boot-starter-jdbc'
		//H2 ë°ì´í„°ë² ì´ìŠ¤ ì¶”ê°€
		runtimeOnly 'com.h2database:h2'
		compileOnly 'org.projectlombok:lombok'
		annotationProcessor 'org.projectlombok:lombok'
		testImplementation 'org.springframework.boot:spring-boot-starter-test'

		//í…ŒìŠ¤íŠ¸ì—ì„œ lombok ì‚¬ìš©
		testCompileOnly 'org.projectlombok:lombok' 
		testAnnotationProcessor 'org.projectlombok:lombok'
}
```

- `org.springframework.boot:spring-boot-starter-jdbc` ë¥¼ ì¶”ê°€í•˜ë©´ JdbcTemplateì´ ë“¤ì–´ìˆëŠ” `spring-jdbc`ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— í¬í•¨ëœë‹¤.
- ì—¬ê¸°ì„œëŠ” H2 ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ì†í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— H2 ë°ì´í„°ë² ì´ìŠ¤ì˜ í´ë¼ì´ì–¸íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬(Jdbc Driver)ë„ ì¶”ê°€í•˜ì.
    - `runtimeOnly â€˜com.h2database:h2â€™`

**ì¶”ê°€ë˜ëŠ” ë¶€ë¶„**

```
//JdbcTemplate ì¶”ê°€
implementation 'org.springframework.boot:spring-boot-starter-jdbc'
//H2 ë°ì´í„°ë² ì´ìŠ¤ ì¶”ê°€
runtimeOnly 'com.h2database:h2'
```

JdbcTemplateì€ `spring-jdbc` ë¼ì´ë¸ŒëŸ¬ë¦¬ë§Œ ì¶”ê°€í•˜ë©´ ëœë‹¤. ë³„ë„ì˜ ì¶”ê°€ ì„¤ì • ê³¼ì •ì€ ì—†ë‹¤.

âš ï¸Â ì£¼ì˜

ì§„í–‰í•˜ê¸° ì „ì— ë¨¼ì € H2 ë°ì´í„°ë² ì´ìŠ¤ì— `item` í…Œì´ë¸”ì„ ìƒì„±í•´ì•¼ í•œë‹¤.

```sql
drop table if exists item CASCADE;
create table item
(
    id        bigint generated by default as identity,
    item_name varchar(10),
    price     integer,
    quantity  integer,
    primary key (id)
);
```

## JdbcTempltate ì ìš©1 - ê¸°ë³¸

ì´ì œë¶€í„° ë³¸ê²©ì ìœ¼ë¡œ JdbcTemplateì„ ì‚¬ìš©í•´ì„œ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ë˜ ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•´ë³´ì.

`ItemRepository` ì¸í„°í˜ì´ìŠ¤ê°€ ìˆìœ¼ë‹ˆ ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ JdbcTemplateì„ ì‚¬ìš©í•˜ëŠ” êµ¬í˜„ì²´ë¥¼ ê°œë°œí•˜ì.

**JdbcTemplateItemRepositoryV1**

```java
package hello.itemservice.repository.jdbctemplate;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import lombok.extern.slf4j.Slf4j;
import org.springframework.dao.EmptyResultDataAccessException;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.support.GeneratedKeyHolder;
import org.springframework.jdbc.support.KeyHolder;
import org.springframework.stereotype.Repository;
import org.springframework.util.StringUtils;

import javax.sql.DataSource;
import java.sql.PreparedStatement;
import java.util.ArrayList;
import java.util.List;
import java.util.Optional;

/**
 * JdbcTemplate
 */
@Slf4j
@Repository
public class JdbcTemplateItemRepositoryV1 implements ItemRepository {

    private final JdbcTemplate template;

    public JdbcTemplateItemRepositoryV1(DataSource dataSource) {
        this.template = new JdbcTemplate(dataSource);
    }

    @Override
    public Item save(Item item) {
        String sql = "insert into item (item_name, price, quantity) values (?, ?, ?)";
        KeyHolder keyHolder = new GeneratedKeyHolder();
        template.update(connection -> {
            //ìë™ ì¦ê°€ í‚¤
            PreparedStatement ps = connection.prepareStatement(sql, new String[]{"id"});
            ps.setString(1, item.getItemName());
            ps.setInt(2, item.getPrice());
            ps.setInt(3, item.getQuantity());
            return ps;
        }, keyHolder);

        long key = keyHolder.getKey().longValue();
        item.setId(key);
        return item;
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        String sql = "update item set item_name=?, price=?, quantity=? where id=?";

        template.update(sql,
                updateParam.getItemName(),
                updateParam.getPrice(),
                updateParam.getQuantity(),
                itemId);
    }

    @Override
    public Optional<Item> findById(Long id) {
        String sql = "select id, item_name, price, quantity from item where id=?";

        try {
            Item item = template.queryForObject(sql, itemRowMapper(), id);
            return Optional.of(item);
        } catch (EmptyResultDataAccessException e) {
            return Optional.empty();
        }

    }

    @Override
    public List<Item> findAll(ItemSearchCond cond) {
        String itemName = cond.getItemName();
        Integer maxPrice = cond.getMaxPrice();

        String sql = "select id, item_name, price, quantity from item";
        //ë™ì  ì¿¼ë¦¬
        if (StringUtils.hasText(itemName) || maxPrice != null) {
            sql += " where";
        }

        boolean andFlag = false;
        List<Object> param = new ArrayList<>();
        if (StringUtils.hasText(itemName)) {
            sql += " item_name like concat('%', ?, '%')";
            param.add(itemName);
            andFlag = true;
        }

        if (maxPrice != null) {
            if (andFlag) {
                sql += " and";
            }
            sql += " price <= ?";
            param.add(maxPrice);
        }
        
        log.info("sql = {}", sql);
        return template.query(sql, itemRowMapper(), param.toArray());
    }

    private RowMapper<Item> itemRowMapper() {
        return (rs, rowNum) -> {
            Item item = new Item();
            item.setId(rs.getLong("id"));
            item.setItemName(rs.getString("item_name"));
            item.setPrice(rs.getInt("price"));
            item.setQuantity(rs.getInt("quantity"));
            return item;
        };
    }
}
```

### ê¸°ë³¸

- `JdbcTemplateItemRepositoryV1`ì€ `ItemRepository` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆë‹¤.
- `this.template = new JdbcTemplate(dataSource)`
    - `JdbcTemplate`ì€ ë°ì´í„°ì†ŒìŠ¤(`dataSource`)ê°€ í•„ìš”í•˜ë‹¤.
    - `JdbcTemplateItemRepositoryV1()` ìƒì„±ìë¥¼ ë³´ë©´ `dataSource`ë¥¼ ì˜ì¡´ ê´€ê³„ ì£¼ì… ë°›ê³  ìƒì„±ì ë‚´ë¶€ì—ì„œ `JdbcTemplate`ì„ ìƒì„±í•œë‹¤. ìŠ¤í”„ë§ì—ì„œëŠ” `JdbcTemplate`ì„ ì‚¬ìš©í•  ë•Œ ê´€ë¡€ìƒ ì´ ë°©ë²•ì„ ë§ì´ ì‚¬ìš©í•œë‹¤.
    - ë¬¼ë¡  `JdbcTemplate`ì„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ì§ì ‘ ë“±ë¡í•˜ê³  ì£¼ì…ë°›ì•„ë„ ëœë‹¤.

### save()

ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.

- `template.update()` : ë°ì´í„°ë¥¼ ë³€ê²½í•  ë•ŒëŠ” `update()`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
    - `INSERT`, `UPDATE`, `DELETE` SQLì— ì‚¬ìš©í•œë‹¤.
    - `template.update()`ì˜ ë°˜í™˜ ê°’ì€ `int`ì¸ë°, ì˜í–¥ ë°›ì€ ë¡œìš° ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤.
- ë°ì´í„°ë¥¼ ì €ì¥í•  ë•Œ PK ìƒì„±ì— `identity`(auto increment) ë°©ì‹ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, PKì¸ ID ê°’ì„ ê°œë°œìê°€ ì§ì ‘ ì§€ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë¹„ì›Œë‘ê³  ì €ì¥í•´ì•¼ í•œë‹¤. ê·¸ëŸ¬ë©´ ë°ì´í„°ë² ì´ìŠ¤ê°€ PKì¸ IDë¥¼ ëŒ€ì‹  ìƒì„±í•´ì¤€ë‹¤.
- ë¬¸ì œëŠ” ì´ë ‡ê²Œ ë°ì´í„°ë² ì´ìŠ¤ê°€ ëŒ€ì‹  ìƒì„±í•´ì£¼ëŠ” PK ID ê°’ì€ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒì„±í•˜ê¸° ë•Œë¬¸ì—, ë°ì´í„°ë² ì´ìŠ¤ì— INSERTê°€ ì™„ë£Œ ë˜ì–´ì•¼ ìƒì„±ëœ PK ID ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- `KeyHolder`ì™€ `connection.prepareStatement(sql, new STring[]{â€idâ€})`ë¥¼ ì‚¬ìš©í•´ì„œ `id`ë¥¼ ì§€ì •í•´ì£¼ë©´ INSERT ì¿¼ë¦¬ ì‹¤í–‰ ì´í›„ì— ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìƒì„±ëœ ID ê°’ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.
- ë¬¼ë¡  ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìƒì„±ëœ ID ê°’ì„ ì¡°íšŒí•˜ëŠ” ê²ƒì€ ìˆœìˆ˜ JDBCë¡œë„ ê°€ëŠ¥í•˜ì§€ë§Œ, ì½”ë“œê°€ í›¨ì”¬ ë” ë³µì¡í•˜ë‹¤.
- ì°¸ê³ ë¡œ ë’¤ì—ì„œ ì„¤ëª…í•˜ê² ì§€ë§Œ JdbcTemplateì´ ì œê³µí•˜ëŠ” `SimpleJdbcInsert`ë¼ëŠ” í›¨ì”¬ í¸ë¦¬í•œ ê¸°ëŠ¥ì´ ìˆìœ¼ë¯€ë¡œ ëŒ€ëµ ì´ë ‡ê²Œ ì‚¬ìš©í•œë‹¤ ì •ë„ë¡œë§Œ ì•Œì•„ë‘ë©´ ëœë‹¤.

### update()

ë°ì´í„°ë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.

- template.update() : ë°ì´í„°ë¥¼ ë³€ê²½í•  ë•ŒëŠ” update()ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
    - `?` ì— ë°”ì¸ë”©í•  íŒŒë¼ë¯¸í„°ë¥¼ ìˆœì„œëŒ€ë¡œ ì „ë‹¬í•˜ë©´ ëœë‹¤.
    - ë°˜í™˜ ê°’ì€ í•´ë‹¹ ì¿¼ë¦¬ì˜ ì˜í–¥ì„ ë°›ì€ ë¡œìš° ìˆ˜ì´ë‹¤. ì—¬ê¸°ì„œëŠ” `where id=?` ë¥¼ ì§€ì •í–ˆê¸° ë•Œë¬¸ì— ì˜í–¥ë°›ì€ ë¡œìš°ìˆ˜ëŠ” ìµœëŒ€ 1ê°œì´ë‹¤.

### findById()

ë°ì´í„°ë¥¼ í•˜ë‚˜ ì¡°íšŒí•œë‹¤.

- `template.queryForObject()`
    - ê²°ê³¼ ë¡œìš°ê°€ í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©í•œë‹¤.
    - `RowMapper`ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°˜í™˜ ê²°ê³¼ì¸ `ResultSet`ì„ ê°ì²´ë¡œ ë³€í™˜í•œë‹¤.
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ `EmptyResultDataAccessException` ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
    - ê²°ê³¼ê°€ ë‘˜ ì´ìƒì´ë©´ `IncorrectResultSizeDataAccessException` ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.
- `ItemRepository.findById()` ì¸í„°í˜ì´ìŠ¤ëŠ” ê²°ê³¼ê°€ ì—†ì„ ë•Œ `Optional`ì„ ë°˜í™˜í•´ì•¼ í•œë‹¤. ë”°ë¼ì„œ ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ì˜ˆì™¸ê°€ ì¡ì•„ì„œ `Optional.empty`ë¥¼ ëŒ€ì‹  ë°˜í™˜í•˜ë©´ ëœë‹¤.

### queryForObject() ì¸í„°í˜ì´ìŠ¤ ì •ì˜

```java
<T> T queryForObject(String sql, RowMapper<T> rowMapper, Object... args) throws
DataAccessException;
```

### findAll()

ë°ì´í„°ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ì¡°íšŒí•œë‹¤. ê·¸ë¦¬ê³  ê²€ìƒ‰ ì¡°ê±´ìœ¼ë¡œ ì ì ˆí•œ ë°ì´í„°ë¥¼ ì°¾ëŠ”ë‹¤.

- `template.query()`
    - ê²°ê³¼ê°€ í•˜ë‚˜ ì´ìƒì¼ ë•Œ ì‚¬ìš©í•œë‹¤.
    - `RowMapper`ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ë°˜í™˜ ê²°ê³¼ì¸ `ResultSet`ì„ ê°ì²´ë¡œ ë³€í™˜í•œë‹¤.
    - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¹ˆ ì»¬ë ‰ì…˜ì„ ë°˜í™˜í•œë‹¤.
    - ë™ì  ì¿¼ë¦¬ì— ëŒ€í•œ ë¶€ë¶„ì€ ë°”ë¡œ ë‹¤ìŒì— ë‹¤ë£¬ë‹¤.

### query() ì¸í„°í˜ì´ìŠ¤ ì •ì˜

```java
<T> List<T> query(String sql, RowMapper<T> rowMapper, Object... args) throws
DataAccessException;
```

### itemRowMapper()

ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¡°íšŒ ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë³€í™˜í•  ë•Œ ì‚¬ìš©í•œë‹¤.

JDBCë¥¼ ì§ì ‘ ì‚¬ìš©í•  ë•Œ `ResultSet`ë¥¼ ì‚¬ìš©í–ˆë˜ ë¶€ë¶„ì„ ë– ì˜¬ë¦¬ë©´ ëœë‹¤.

ì°¨ì´ê°€ ìˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ JdbcTemplateì´ ë‹¤ìŒê³¼ ê°™ì€ ë£¨í”„ë¥¼ ëŒë ¤ì£¼ê³ , ê°œë°œìëŠ” RowMapperë¥¼ êµ¬í˜„í•´ì„œ ê·¸ ë‚´ë¶€ ì½”ë“œë§Œ ì±„ìš´ë‹¤ê³  ì´í•´í•˜ë©´ ëœë‹¤.

```java
while(resultSet ì´ ëë‚  ë•Œ ê¹Œì§€) { 
		rowMapper(rs, rowNum)
}
```

## JdbcTemplate ì ìš©2 - ë™ì  ì¿¼ë¦¬ ë¬¸ì œ

ê²°ê³¼ë¥¼ ê²€ìƒ‰í•˜ëŠ” findAll()ì—ì„œ ì–´ë ¤ìš´ ë¶€ë¶„ì€ ì‚¬ìš©ìê°€ ê²€ìƒ‰í•˜ëŠ” ê°’ì— ë”°ë¼ì„œ ì‹¤í–‰í•˜ëŠ” SQLì´ ë™ì ìœ¼ë¡œ ë‹¬ë¼ì ¸ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ì„œ ë‹¤ìŒê³¼ ê°™ë‹¤.

**ê²€ìƒ‰ ì¡°ê±´ì´ ì—†ìŒ**

```sql
select id, item_name, price, quantity from item
```

**ìƒí’ˆëª…(itemName)ìœ¼ë¡œ ê²€ìƒ‰**

```sql
select id, item_name, price, quantity from item
   where item_name like concat('%',?,'%')
```

**ìµœëŒ€ ê°€ê²©(maxPrice)ìœ¼ë¡œ ê²€ìƒ‰**

```sql
select id, item_name, price, quantity from item
   where price <= ?
```

**ìƒí’ˆëª…(itemName), ìµœëŒ€ ê°€ê²©(maxPrice) ë‘˜ë‹¤ ê²€ìƒ‰**

```sql
select id, item_name, price, quantity from item
 where item_name like concat('%',?,'%')
	and price <= ?
```

ê²°ê³¼ì ìœ¼ë¡œ 4ê°€ì§€ ìƒí™©ì— ë”°ë¥¸ SQLì„ ë™ì ìœ¼ë¡œ ìƒì„±í•´ì•¼ í•œë‹¤. ë™ì  ì¿¼ë¦¬ê°€ ì–¸ë“¯ ë³´ë©´ ì‰¬ì›Œ ë³´ì´ì§€ë§Œ, ë§‰ìƒ ê°œë°œí•´ë³´ë©´ ìƒê°ë³´ë‹¤ ë‹¤ì–‘í•œ ìƒí™©ì„ ê³ ë¯¼í•´ì•¼ í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ì–´ë–¤ ê²½ìš°ì—ì„œ `where`ë¥¼ ì•ì— ë„£ê³  ì–´ë–¤ ê²½ìš°ì—ëŠ” `and`ë¥¼ ë„£ì–´ì•¼ í•˜ëŠ”ì§€ ë“±ì„ ëª¨ë‘ ê³„ì‚°í•´ì•¼ í•œë‹¤.

ê·¸ë¦¬ê³  ê° ìƒí™©ì— ë§ì¶”ì–´ íŒŒë¼ë¯¸í„°ë„ ìƒì„±í•´ì•¼ í•œë‹¤.

ë¬¼ë¡  ì‹¤ë¬´ì—ì„œë„ ì´ë³´ë‹¤ í›¨ì”¬ ë” ë³µì¡í•œ ë™ì  ì¿¼ë¦¬ë“¤ì´ ì‚¬ìš©ëœë‹¤.

ì°¸ê³ ë¡œ ì´í›„ì— ì„¤ëª…í•  MyBatisì˜ ê°€ì¥ í° ì¥ì ì€ SQLì„ ì§ì ‘ ì‚¬ìš©í•  ë•Œ ë™ì  ì¿¼ë¦¬ë¥¼ ì‰½ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ë‹¤.

## JdbcTempalte ì ìš©3 - êµ¬ì„±ê³¼ ì‹¤í–‰

ì‹¤ì œ ì½”ë“œê°€ ë™ì‘í•˜ë„ë¡ êµ¬ì„±í•˜ê³  ì‹¤í–‰í•´ë³´ì.

**JdbcTemplateV1Config**

```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.jdbctemplate.JdbcTemplateItemRepositoryV1;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
@RequiredArgsConstructor
public class JdbcTemplateV1Config {

    private final DataSource dataSource;

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new JdbcTemplateItemRepositoryV1(dataSource);
    }

}
```

- `ItemRepository` êµ¬í˜„ì²´ë¡œ `JdbcTemplateItemRepositoryV1`ì´ ì‚¬ìš©ë˜ë„ë¡ í–ˆë‹¤. ì´ì œ ë©”ëª¨ë¦¬ ì €ì¥ì†Œê°€ ì•„ë‹ˆë¼ ì‹¤ì œ DBì— ì—°ê²°í•˜ëŠ” JdbcTemplateì´ ì‚¬ìš©ëœë‹¤.

**ItemServiceApplication - ë³€ê²½**

```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;

//@Import(MemoryConfig.class)
**@Import(JdbcTemplateV1Config.class)**
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

	@Bean
	@Profile("local")
	public TestDataInit testDataInit(ItemRepository itemRepository) {
		return new TestDataInit(itemRepository);
	}

}
```

**ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ ì„¤ì •**

`src/main/resources/application.properties`

```java
spring.profiles.active=local
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.username=sa
```

- ì´ë ‡ê²Œ ì„¤ì •ë§Œ í•˜ë©´ ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ í•´ë‹¹ ì„¤ì •ì„ ì‚¬ìš©í•´ì„œ ì»¤ë„¥ì…˜ í’€ê³¼ `DataSource`, íŠ¸ëœì­ì…˜ ë§¤ë‹ˆì €ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ìë™ ë“±ë¡í•œë‹¤.
    
    (ì•ì—ì„œ í•™ìŠµí•œ ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ìë™ ë¦¬ì†ŒìŠ¤ ë“±ë¡ ë‚´ìš©ì„ ë– ì˜¬ë ¤ë³´ì.)
    

> âš ï¸Â ì£¼ì˜!
ì—¬ê¸°ì„œëŠ” `src/test`ê°€ ì•„ë‹ˆë¼ `src/main`ì— ìœ„ì¹˜í•œ `application.properties` íŒŒì¼ì„ ìˆ˜ì •í•´ì•¼ í•œë‹¤!
> 

**ì‹¤í–‰**

- ì‹¤ì œ DBì— ì—°ê²°í•´ì•¼ í•˜ë¯€ë¡œ H2 ë°ì´í„°ë² ì´ìŠ¤ ì„œë²„ë¥¼ ë¨¼ì € ì‹¤í–‰í•˜ì.
- ì•ì„œ ë§Œë“  item í…Œì´ë¸”ì´ ì˜ ìƒì„±ë˜ì–´ ìˆëŠ”ì§€ ë‹¤ì‹œ í™•ì¸í•˜ì.
- `ItemServiceApplication.main()`ì„ ì‹¤í–‰í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë¥¼ ì‹¤í–‰í•˜ì.

- ì›¹ ë¸Œë¼ìš°ì €ë¡œ ë‹¤ìŒì— ì ‘ì†í•˜ì : `http://localhost:8080`
- ì‹¤í–‰í•´ë³´ë©´ ì˜ ë™ì‘í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. ê·¸ë¦¬ê³  DBì— ì‹¤ì œ ë°ì´í„°ê°€ ì €ì¥ë˜ëŠ” ê²ƒë„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- ì°¸ê³ ë¡œ ì„œë²„ë¥¼ ë‹¤ì‹œ ì‹œì‘í•  ë•Œ ë§ˆë‹¤ `TestDataInit`ì´ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— `itemA`, `itemB`ë„ ë°ì´í„°ë² ì´ìŠ¤ì— ê³„ì† ì¶”ê°€ëœë‹¤. ë©”ëª¨ë¦¬ì™€ ë‹¤ë¥´ê²Œ ì„œë²„ê°€ ë‚´ë ¤ê°€ë„ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ìœ ì§€ë˜ê¸° ë•Œë¬¸ì´ë‹¤.

**ë¡œê·¸ ì¶”ê°€**

JdbcTemplateì´ ì‹¤í–‰í•˜ëŠ” SQL ë¡œê·¸ë¥¼ í™•ì¸í•˜ë ¤ë©´ `application.properties`ì— ë‹¤ìŒì„ ì¶”ê°€í•˜ë©´ ëœë‹¤. `main`, `test` ì„¤ì •ì´ ë¶„ë¦¬ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ë‘˜ë‹¤ í™•ì¸í•˜ë ¤ë©´ ë‘ ê³³ì— ëª¨ë‘ ì¶”ê°€í•´ì•¼ í•œë‹¤.

```java
#jdbcTemplate sql log
logging.level.org.springframework.jdbc=debug
```

## JdbcTemplate - ì´ë¦„ ì§€ì • íŒŒë¼ë¯¸í„° 1

### ìˆœì„œëŒ€ë¡œ ë°”ì¸ë”©

JdbcTemplateì„ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ë©´ íŒŒë¼ë¯¸í„°ë¥¼ ìˆœì„œëŒ€ë¡œ ë°”ì¸ë”© í•œë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ì„œ ë‹¤ìŒ ì½”ë“œë¥¼ ë³´ì.

```java
String sql = "update item set item_name=?, price=?, quantity=? where id=?";
template.update(sql,
        itemName,
        price,
        quantity,
        itemId);
```

ì—¬ê¸°ì„œëŠ” `itemName`, `price`, `quantity`ê°€ SQLì— ìˆëŠ” ?ì— ìˆœì„œëŒ€ë¡œ ë°”ì¸ë”© ëœë‹¤.

ë”°ë¼ì„œ ìˆœì„œë§Œ ì˜ ì§€í‚¤ë©´ ë¬¸ì œê°€ ë  ê²ƒì€ ì—†ë‹¤. ê·¸ëŸ°ë° ë¬¸ì œëŠ” ë³€ê²½ì‹œì ì— ë°œìƒí•œë‹¤.

ëˆ„êµ°ê°€ ë‹¤ìŒê³¼ ê°™ì´ SQL ì½”ë“œì˜ ìˆœì„œë¥¼ ë³€ê²½í–ˆë‹¤ê³  ê°€ì •í•´ë³´ì. (`price`ì™€ `quantity`ì˜ ìˆœì„œë¥¼ ë³€ê²½í–ˆë‹¤.)

```java
String sql = "update item set item_name=?, quantity=?, price=? where id=?";
template.update(sql,
        itemName,
        price,
        quantity,
        itemId);
```

ì´ë ‡ê²Œ ë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ë°ì´í„°ê°€ ë°”ì¸ë”© ëœë‹¤.

`item_name=itemName, quantity=price, price=quantity`

ê²°ê³¼ì ìœ¼ë¡œ `price`ì™€ `quantity`ê°€ ë°”ë€ŒëŠ” ë§¤ìš° ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ì´ëŸ°ì¼ì´ ì—†ì„ ê²ƒ ê°™ì§€ë§Œ, ì‹¤ë¬¸ì—ì„œëŠ” íŒŒë¼ë¯¸í„°ê°€ 10~20ê°œê°€ ë„˜ì–´ê°€ëŠ” ì¼ì´ ì•„ì£¼ ë§ë‹¤. ê·¸ë˜ì„œ ë¯¸ë˜ì— í•„ë“œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜, ìˆ˜ì •í•˜ë©´ì„œ ì´ëŸ° ë¬¸ì œê°€ ì¶©ë¶„íˆ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

ë²„ê·¸ ì¤‘ì—ì„œ ê°€ì¥ ê³ ì¹˜ê¸° í˜ë“  ë²„ê·¸ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ë°ì´í„°ê°€ ì˜ëª» ë“¤ì–´ê°€ëŠ” ë²„ê·¸ë‹¤. ì´ê²ƒì€ ì½”ë“œë§Œ ê³ ì¹˜ëŠ” ìˆ˜ì¤€ì´ ì•„ë‹ˆë¼ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ë³µí›„í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ë²„ê·¸ë¥¼ í•´ê²°í•˜ëŠ”ë° ë“¤ì–´ê°€ëŠ” ë¦¬ì†ŒìŠ¤ê°€ ì–´ë§ˆì–´ë§ˆí•˜ë‹¤.

ì‹¤ì œë¡œ ìˆ˜ë§ì€ ê°œë°œìë“¤ì´ ì´ ë¬¸ì œë¡œ ì¥ì• ë¥¼ ë‚´ê³  í‡´ê·¼í•˜ì§€ ëª»í•˜ëŠ” ì¼ì´ ë°œìƒí•œë‹¤.

**ê°œë°œì„ í•  ë•ŒëŠ” ì½”ë“œë¥¼ ëª‡ì¤„ ì¤„ì´ëŠ” í¸ë¦¬í•¨ë„ ì¤‘ìš”í•˜ì§€ë§Œ, ëª¨í˜¸í•¨ì„ ì œê±°í•´ì„œ ì½”ë“œë¥¼ ëª…í™•í•˜ê²Œ ë§Œë“œëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ ê´€ì ì—ì„œ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤.**

ì´ì²˜ëŸ¼ íŒŒë¼ë¯¸í„°ë¥¼ ìˆœì„œëŒ€ë¡œ ë°”ì¸ë”© í•˜ëŠ” ê²ƒì€ í¸ë¦¬í•˜ê¸°ëŠ” í•˜ì§€ë§Œ, ìˆœì„œê°€ ë§ì§€ ì•Šì•„ì„œ ë²„ê·¸ê°€ ë°œìƒí•  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.

### ì´ë¦„ ì§€ì • ë°”ì¸ë”©

JdbcTemplateì€ ì´ëŸ° ë¬¸ì œë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ `NamedParameterJdbcTemplate`ë¼ëŠ” ì´ë¦„ì„ ì§€ì •í•´ì„œ íŒŒë¼ë¯¸í„°ë¥¼ ë°”ì¸ë”© í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

**JdbcTemplateIemRepositoryV2**

```java
package hello.itemservice.repository.jdbctemplate;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import lombok.extern.slf4j.Slf4j;
import org.springframework.dao.EmptyResultDataAccessException;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.jdbc.core.namedparam.SqlParameterSource;
import org.springframework.jdbc.support.GeneratedKeyHolder;
import org.springframework.jdbc.support.KeyHolder;
import org.springframework.stereotype.Repository;
import org.springframework.util.StringUtils;

import javax.sql.DataSource;
import java.sql.PreparedStatement;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import java.util.Optional;

/**
 * NamedParameterJdbcTemplate
 * sqlParameterSource
 * - BeanPropertySqlParameterSource
 * - MapSqlParameterSource
 * Map
 *
 * BeanPropertyRowMapper
 */
@Slf4j
@Repository
public class JdbcTemplateItemRepositoryV2 implements ItemRepository {

    private final NamedParameterJdbcTemplate template;

    public JdbcTemplateItemRepositoryV2(DataSource dataSource) {
        this.template = new NamedParameterJdbcTemplate(dataSource);
    }

    @Override
    public Item save(Item item) {
        String sql = "insert into item (item_name, price, quantity) " +
                "values (:itemName, :price, :quantity)";

        SqlParameterSource param = new BeanPropertySqlParameterSource(item);
        KeyHolder keyHolder = new GeneratedKeyHolder();
        template.update(sql, param, keyHolder);

        long key = keyHolder.getKey().longValue();
        item.setId(key);
        return item;
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        String sql = "update item " +
                "set item_name=:itemName, price=:price, quantity=:quantity " +
                "where id=:id";

        SqlParameterSource param = new MapSqlParameterSource()
                .addValue("itemName", updateParam.getItemName())
                .addValue("price", updateParam.getPrice())
                .addValue("quantity", updateParam.getQuantity())
                .addValue("id", itemId);  //ì´ ë¶€ë¶„ì´ ë³„ë„ë¡œ í•„ìš”í•˜ë‹¤.
        template.update(sql, param);
    }

    @Override
    public Optional<Item> findById(Long id) {
        String sql = "select id, item_name, price, quantity from item where id= :id";

        try {
            Map<String, Object> param = Map.of("id", id);
            Item item = template.queryForObject(sql, param, itemRowMapper());
            return Optional.of(item);
        } catch (EmptyResultDataAccessException e) {
            return Optional.empty();
        }

    }

    @Override
    public List<Item> findAll(ItemSearchCond cond) {
        String itemName = cond.getItemName();
        Integer maxPrice = cond.getMaxPrice();

        SqlParameterSource param = new BeanPropertySqlParameterSource(cond);

        String sql = "select id, item_name, price, quantity from item";
        //ë™ì  ì¿¼ë¦¬
        if (StringUtils.hasText(itemName) || maxPrice != null) {
            sql += " where";
        }

        boolean andFlag = false;
        if (StringUtils.hasText(itemName)) {
            sql += " item_name like concat('%', :itemName, '%')";
            andFlag = true;
        }

        if (maxPrice != null) {
            if (andFlag) {
                sql += " and";
            }
            sql += " price <= :maxPrice";
        }

        log.info("sql = {}", sql);
        return template.query(sql, param, itemRowMapper());
    }

    private RowMapper<Item> itemRowMapper() {
        return BeanPropertyRowMapper.newInstance(Item.class);  //camel ë³€í™˜ ì§€ì›
    }
}
```

### ê¸°ë³¸

- `JdbcTemplateItemRepositoryV2`ëŠ” `ItemRepository` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆë‹¤.
- `this.template = new NamedParameterJdbcTemplate(dataSource)`
    - `NamedParameterJdbcTemplate`ë„ ë‚´ë¶€ì— `dataSource`ê°€ í•„ìš”í•˜ë‹¤.
    - `JdbcTemplateItemRepositoryV2` ìƒì„±ìë¥¼ ë³´ë©´ ì˜ì¡´ê´€ê³„ ì£¼ì…ì€ `dataSource`ë¥¼ ë°›ê³  ë‚´ë¶€ì—ì„œ `NamedParameterJdbcTemplate`ì„ ìƒì„±í•´ì„œ ê°€ì§€ê³  ìˆë‹¤. ìŠ¤í”„ë§ì—ì„œëŠ” `JdbcTemplate`ê´€ë ¨ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œ ê´€ë¡€ìƒ ì´ ë°©ë²•ì„ ë§ì´ ì‚¬ìš©í•œë‹¤.
    - ë¬¼ë¡  `NamedParameterJdbcTemplate`ì„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ì§ì ‘ ë“±ë¡í•˜ê³  ì£¼ì…ë°›ì•„ë„ ëœë‹¤.

### save()

SQLì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ `?` ëŒ€ì‹ ì— `:íŒŒë¼ë¯¸í„°ì´ë¦„` ì„ ë°›ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```java
insert into item (item_name, price, quantity) " +
		"values (:itemName, :price, :quantity)"
```

ì¶”ê°€ë¡œ `NamedParameterJdbcTemplate`ì€ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒì„±í•´ì£¼ëŠ” í‚¤ë¥¼ ë§¤ìš° ì‰½ê²Œ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥ë„ ì œê³µí•´ì¤€ë‹¤.

## JdbcTemplate - ì´ë¦„ ì§€ì • íŒŒë¼ë¯¸í„° 2

### ì´ë¦„ ì§€ì • íŒŒë¼ë¯¸í„°

íŒŒë¼ë¯¸í„°ë¥¼ ì „ë‹¬í•˜ë ¤ë©´ `Map`ì²˜ëŸ¼ `key`, `value` ë°ì´í„° êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ì„œ ì „ë‹¬í•´ì•¼ í•œë‹¤.

ì—¬ê¸°ì„œ `key`ëŠ” `:íŒŒë¼ë¯¸í„°ì´ë¦„` ìœ¼ë¡œ ì§€ì •í•œ, íŒŒë¼ë¯¸í„°ì˜ ì´ë¦„ì´ê³ , `value`ëŠ” í•´ë‹¹ íŒŒë¼ë¯¸í„°ì˜ ê°’ì´ ëœë‹¤.

ë‹¤ìŒ ì½”ë“œë¥¼ ë³´ë©´ ì´ë ‡ê²Œ ë§Œë“  íŒŒë¼ë¯¸í„°(`param`)ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

`template.update(sql, param, keyHolder);`

ì´ë¦„ ì§€ì • ë°”ì¸ë”©ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” íŒŒë¼ë¯¸í„°ì˜ ì¢…ë¥˜ëŠ” í¬ê²Œ 3ê°€ì§€ê°€ ìˆë‹¤.

- `Map`
- `SqlParameterSource`
    - `MapSqlParameterSource`
    - `BeanPropertySqlParameterSource`

### 1. Map

ë‹¨ìˆœíˆ `Map`ì„ ì‚¬ìš©í•œë‹¤.

`findById()` ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```java
Map<String, Object> param = Map.of("id", id);
Item item = template.queryForObject(sql, param, itemRowMapper());
```

### 2. MapSqlParameterSource

`Map`ê³¼ ìœ ì‚¬í•œë°, SQL íƒ€ì…ì„ ì§€ì •í•  ìˆ˜ ìˆëŠ” ë“± SQLì— ì¢€ ë” íŠ¹í™”ëœ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

`SqlParameterSource` ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ì´ë‹¤.

`MapSqlParameterSource`ëŠ” ë©”ì„œë“œ ì²´ì¸ì„ í†µí•´ í¸ë¦¬í•œ ì‚¬ìš©ë²•ë„ ì œê³µí•œë‹¤.

`update()` ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```java
SqlParameterSource param = new MapSqlParameterSource()
        .addValue("itemName", updateParam.getItemName())
        .addValue("price", updateParam.getPrice())
        .addValue("quantity", updateParam.getQuantity())
        .addValue("id", itemId);  //ì´ ë¶€ë¶„ì´ ë³„ë„ë¡œ í•„ìš”í•˜ë‹¤.
template.update(sql, param);
```

### 3. BeanPropertySqlParameterSource

ìë°”ë¹ˆ í”„ë¡œí¼í‹° ê·œì•½ì„ í†µí•´ì„œ ìë™ìœ¼ë¡œ íŒŒë¼ë¯¸í„° ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

ì˜ˆ) (`getXxx() â†’ xxx, getItemName() â†’ itemName`)

ì˜ˆë¥¼ ë“¤ì–´ì„œ `getItemName()`, `getProce()`ê°€ ìˆìœ¼ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ë‚¸ë‹¤.

- `key=itemName, value=ìƒí’ˆëª… ê°’`
- `key=price, value=ê°€ê²© ê°’`

`SqlParameterSource` ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ì´ë‹¤.

`save()`, `findAll(`) ì½”ë“œì—ì„œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```java
SqlParameterSource param = new BeanPropertySqlParameterSource(item);
KeyHolder keyHolder = new GeneratedKeyHolder();
template.update(sql, param, keyHolder);
```

- ì—¬ê¸°ì„œ ë³´ë©´ `BeanPropertySqlParameterSource`ê°€ ë§ì€ ê²ƒì„ ìë™í™” í•´ì£¼ê¸° ë•Œë¬¸ì— ê°€ì¥ ì¢‹ì•„ë³´ì´ì§€ë§Œ, `BeanPropertySqlParameterSource`ë¥¼ í•­ìƒ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê²ƒì€ ì•„ë‹ˆë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´ì„œ `update()`ì—ì„œëŠ” SQLì— `:id`ë¥¼ ë°”ì¸ë”© í•´ì•¼ í•˜ëŠ”ë°, `update()`ì—ì„œ ì‚¬ìš©í•˜ëŠ” `ItemUpdateDto`ì—ëŠ” `itemId`ê°€ ì—†ë‹¤. ë”°ë¼ì„œ `BeanPropertySqlParameterSource`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ê³ , ëŒ€ì‹ ì— `MapSqlParameterSource`ë¥¼ ì‚¬ìš©í–ˆë‹¤.

### BeanPropertyRowMapper

ì´ë²ˆ ì½”ë“œì—ì„œ `V1`ê³¼ ë¹„êµí•´ì„œ ë³€í™”ëœ ë¶€ë¶„ì´ í•˜ë‚˜ ë” ìˆë‹¤. ë°”ë¡œ `BeanPropertyRowMapper`ë¥¼ ì‚¬ìš©í•œ ê²ƒì´ë‹¤.

**JdbcTemplateItemRepositoryV1 - itemRowMapper()**

```java
private RowMapper<Item> itemRowMapper() {
    return (rs, rowNum) -> {
        Item item = new Item();
        item.setId(rs.getLong("id"));
        item.setItemName(rs.getString("item_name"));
        item.setPrice(rs.getInt("price"));
        item.setQuantity(rs.getInt("quantity"));
        return item;
    };
}
```

**JdbcTemplateItemRepositoryV2 - itemRowMapper()**

```java
private RowMapper<Item> itemRowMapper() {
    return BeanPropertyRowMapper.newInstance(Item.class);  //camel ë³€í™˜ ì§€ì›
}
```

`BeanPropertyRowMapper`ëŠ” `ResultSet`ì˜ ê²°ê³¼ë¥¼ ë°›ì•„ì„œ ìë°”ë¹ˆ ê·œì•½ì— ë§ì¶”ì–´ ë°ì´í„°ë¥¼ ë³€í™˜í•œë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ ê²°ê³¼ê°€ `select id, price`ë¼ê³  í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œë¥¼ ì‘ì„±í•´ì¤€ë‹¤. (ì‹¤ì œë¡œëŠ” ë¦¬í”Œë ‰ì…˜ ê°™ì€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•œë‹¤.)

```java
Item item = new Item();
item.setId(rs.getLong("id"));
item.setPrice(rs.getInt("price"));
```

ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒí•œ ê²°ê³¼ ì´ë¦„ì„ ê¸°ë°˜ìœ¼ë¡œ `setId()`, `setPrice()` ì²˜ëŸ¼ ìë°”ë¹ˆ í”„ë¡œí¼í‹° ê·œì•½ì— ë§ì¶˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ë‹¤.

**ë³„ì¹­**

ãƒ¥ëŸ°ë° `select item_name`ì˜ ê²½ìš° `setItem_name()`ì´ë¼ëŠ” ë©”ì„œë“œê°€ ì—†ê¸° ë•Œë¬¸ì— ê³¨ì¹˜ê°€ ì•„í”„ë‹¤.

ì´ëŸ° ê²½ìš° ê°œë°œìê°€ ì¡°íšŒ SQLì„ ë‹¤ìŒê³¼ ê°™ì´ ê³ ì¹˜ë©´ ëœë‹¤.

`select item_name as itemName`

ë³„ì¹­ `as`ë¥¼ ì‚¬ìš©í•´ì„œ SQL ì¡°íšŒ ê²°ê³¼ì˜ ì´ë¦„ì„ ë³€ê²½í•˜ë¯„ ê²ƒì´ë‹¤. ì‹¤ì œë¡œ ì´ ë°©ë²•ì€ ìì£¼ ì‚¬ìš©ëœë‹¤. íŠ¹íˆ ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ ì´ë¦„ê³¼ ê°ì²´ ì´ë¦„ì´ ì™„ì „íˆ ë‹¤ë¥¼ ë•Œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ì„œ ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” `member_name`ì´ë¼ê³  ë˜ì–´ ìˆëŠ”ë° ê°ì²´ì— `username`ì´ë¼ê³  ë˜ì–´ ìˆë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

`select member_name as username`

ì´ë ‡ê²Œ ë°ì´í„°ë² ì´ìŠ¤ ì»¬ëŸ¼ ì´ë¦„ê³¼ ê°ì²´ì˜ ì´ë¦„ì´ ë‹¤ë¥¼ ë•Œ ë³„ì¹­(`as`)ì„ ì‚¬ìš©í•´ì„œ ë¬¸ì œë¥¼ ë§ì´ í•´ê²°í•œë‹¤.

`JdbcTemplate`ì€ ë¬¼ë¡ ì´ê³ , `MyBatis` ê°™ì€ ê¸°ìˆ ì—ì„œë„ ìì£¼ ì‚¬ìš©ëœë‹¤.

**ê´€ë¡€ì˜ ë¶ˆì¼ì¹˜**

ìë°” ê°ì²´ëŠ” ì¹´ë©œ(`camelCase`) í‘œê¸°ë²•ì„ ì‚¬ìš©í•œë‹¤. `itemName`ì²˜ëŸ¼ ì¤‘ê°„ì— ë‚™íƒ€ ë´‰ì´ ì˜¬ë¼ì™€ ìˆëŠ” í‘œê¸°ë²•ì´ë‹¤.

ë°˜ë©´ì— ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ì£¼ë¡œ ì–¸ë”ìŠ¤ì½”ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” `snake_case` í‘œê¸°ë²•ì„ ì‚¬ìš©í•œë‹¤.

`item_name`ì²˜ëŸ¼ ì¤‘ê°„ì— ì–¸ë”ìŠ¤ì½”ì–´ë¥¼ ì‚¬ìš©í•˜ëŠ” í‘œê¸°ë²•ì´ë‹¤.

ì´ ë¶€ë¶„ì„ ê´€ë¡€ë¡œ ë§ì´ ì‚¬ìš©í•˜ë‹¤ ë³´ë‹ˆ `BeanPropertyRowMapper`ëŠ” ì–¸ë”ìŠ¤ì½”ì–´ í‘œê¸°ë²•ì„ ì¹´ë©œë¡œ ìë™ ë³€í™˜í•´ì¤€ë‹¤.

ë”°ë¼ì„œ `select item_name`ìœ¼ë¡œ ì¡°íšŒí•´ë„ `setItemName()`ì— ë¬¸ì œ ì—†ì´ ê°’ì´ ë“¤ì–´ê°„ë‹¤.

ì •ë¦¬í•˜ë©´ `sanke_case`ëŠ” ìë™ìœ¼ë¡œ í•´ê²°ë˜ë‹ˆ ê·¸ëƒ¥ ë‘ë©´ ë˜ê³ , ì»¬ëŸ¼ ì´ë¦„ê³¼ ê°ì²´ ì´ë¦„ì´ ì™„ì „íˆ ë‹¤ë¥¸ ê²½ìš°ì—ëŠ” ì¡°íšŒ SQLì—ì„œ ë³„ì¹­ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

## JdbcTemplate - ì´ë¦„ ì§€ì • íŒŒë¼ë¯¸í„° 3

ì´ì œ ì´ë¦„ ì§€ì • íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ë„ë¡ êµ¬ì„±í•˜ê³  ì‹¤í–‰í•´ë³´ì.

**JdbcTemplateV2Config**

```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.jdbctemplate.JdbcTemplateItemRepositoryV2;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
@RequiredArgsConstructor
public class JdbcTemplateV2Config {

    private final DataSource dataSource;

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new JdbcTemplateItemRepositoryV2(dataSource);
    }

}
```

- ì•ì—ì„œ ê°œë°œí•œ `JdbcTemplateItemRepositoryV2`ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•œë‹¤.

**ItemServiceApplication - ë³€ê²½**

```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;

//@Import(MemoryConfig.class)
//@Import(JdbcTemplateV1Config.class)
**@Import(JdbcTemplateV2Config.class)**
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

	@Bean
	@Profile("local")
	public TestDataInit testDataInit(ItemRepository itemRepository) {
		return new TestDataInit(itemRepository);
	}

}
```

- `JdbcTemplateV2Config.class`ë¥¼ ì„¤ì •ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½ë˜ì—ˆë‹¤.
    - `@Import(JdbcTemplateV1Config.class)` â†’ `@Import(JdbcTemplateV2Config.class)`

ì‹¤í–‰í•´ì„œ ê¸°ëŠ¥ì´ ì˜ ë™ì‘ë˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.

## JdbcTemplate - SimpleJdbcInsert

JdbcTemplateì€ INSERT SQLë¥¼ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë˜ë„ë¡ `SimpleJdbcInsert`ë¼ëŠ” í¸ë¦¬í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

**JdbcTemplateItemRepositoryV3**

```java
package hello.itemservice.repository.jdbctemplate;

import hello.itemservice.domain.Item;
import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.ItemSearchCond;
import hello.itemservice.repository.ItemUpdateDto;
import lombok.extern.slf4j.Slf4j;
import org.springframework.dao.EmptyResultDataAccessException;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.jdbc.core.namedparam.BeanPropertySqlParameterSource;
import org.springframework.jdbc.core.namedparam.MapSqlParameterSource;
import org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate;
import org.springframework.jdbc.core.namedparam.SqlParameterSource;
import org.springframework.jdbc.core.simple.SimpleJdbcInsert;
import org.springframework.jdbc.support.GeneratedKeyHolder;
import org.springframework.jdbc.support.KeyHolder;
import org.springframework.stereotype.Repository;
import org.springframework.util.StringUtils;

import javax.sql.DataSource;
import java.util.List;
import java.util.Map;
import java.util.Optional;

/**
 * SimpleJdbcInsert
 */
@Slf4j
@Repository
public class JdbcTemplateItemRepositoryV3 implements ItemRepository {

    private final NamedParameterJdbcTemplate template;
    private final SimpleJdbcInsert jdbcInsert;

    public JdbcTemplateItemRepositoryV3(DataSource dataSource) {
        this.template = new NamedParameterJdbcTemplate(dataSource);
        this.jdbcInsert = new SimpleJdbcInsert(dataSource)
                .withTableName("item")
                .usingGeneratedKeyColumns("id");
//                .usingColumns("item_name", "price", "quantity");  //ìƒëµ ê°€ëŠ¥
    }

    @Override
    public Item save(Item item) {
        SqlParameterSource param = new BeanPropertySqlParameterSource(item);
        Number key = jdbcInsert.executeAndReturnKey(param);
        item.setId(key.longValue());
        return item;
    }

    @Override
    public void update(Long itemId, ItemUpdateDto updateParam) {
        String sql = "update item " +
                "set item_name=:itemName, price=:price, quantity=:quantity " +
                "where id=:id";

        SqlParameterSource param = new MapSqlParameterSource()
                .addValue("itemName", updateParam.getItemName())
                .addValue("price", updateParam.getPrice())
                .addValue("quantity", updateParam.getQuantity())
                .addValue("id", itemId);  //ì´ ë¶€ë¶„ì´ ë³„ë„ë¡œ í•„ìš”í•˜ë‹¤.
        template.update(sql, param);
    }

    @Override
    public Optional<Item> findById(Long id) {
        String sql = "select id, item_name, price, quantity from item where id= :id";

        try {
            Map<String, Object> param = Map.of("id", id);
            Item item = template.queryForObject(sql, param, itemRowMapper());
            return Optional.of(item);
        } catch (EmptyResultDataAccessException e) {
            return Optional.empty();
        }

    }

    @Override
    public List<Item> findAll(ItemSearchCond cond) {
        String itemName = cond.getItemName();
        Integer maxPrice = cond.getMaxPrice();

        SqlParameterSource param = new BeanPropertySqlParameterSource(cond);

        String sql = "select id, item_name, price, quantity from item";
        //ë™ì  ì¿¼ë¦¬
        if (StringUtils.hasText(itemName) || maxPrice != null) {
            sql += " where";
        }

        boolean andFlag = false;
        if (StringUtils.hasText(itemName)) {
            sql += " item_name like concat('%', :itemName, '%')";
            andFlag = true;
        }

        if (maxPrice != null) {
            if (andFlag) {
                sql += " and";
            }
            sql += " price <= :maxPrice";
        }

        log.info("sql = {}", sql);
        return template.query(sql, param, itemRowMapper());
    }

    private RowMapper<Item> itemRowMapper() {
        return BeanPropertyRowMapper.newInstance(Item.class);  //camel ë³€í™˜ ì§€ì›
    }
}
```

**ê¸°ë³¸**

- `JdbcTemplateItemRepositoryV3`ì€ `ItemRepository` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆë‹¤.
- `this.jdbcInsert = new SimpleJdbcInsert(dataSource)` : ìƒì„±ìë¥¼ ë³´ë©´ ì˜ì¡´ê´€ê³„ ì£¼ì…ì€ `dataSource`ë¥¼ ë°›ê³  ë‚´ë¶€ì—ì„œ `SimpleJdbcInsert`ì„ ìƒì„±í•´ì„œ ê°€ì§€ê³  ìˆë‹¤. ìŠ¤í”„ë§ì—ì„œëŠ” `JdbcTemplate` ê´€ë ¨ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œ ê´€ë¡€ìƒ ì´ ë°©ë²•ì„ ë§ì´ ì‚¬ìš©í•œë‹¤.
    - ë¬¼ë¡  `SimpleJdbcInsert`ì„ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ì§ì ‘ ë“±ë¡í•˜ê³  ì£¼ì…ë°›ì•„ë„ ëœë‹¤.

**SimpleJdbcInsert**

```java
this.jdbcInsert = new SimpleJdbcInsert(dataSource)
                .withTableName("item")
                .usingGeneratedKeyColumns("id");
//                .usingColumns("item_name", "price", "quantity");  //ìƒëµ ê°€ëŠ¥
```

- `withTableName` : ë°ì´í„°ë¥¼ ì €ì¥í•  í…Œì´ë¸” ëª…ì„ ì§€ì •í•œë‹¤.
- `usingGeneratedKeyColumns` : `key`ë¥¼ ìƒì„±í•˜ëŠ” PK ì»¬ëŸ¼ ëª…ì„ ì§€ì •í•œë‹¤.
- `usingColumns` : INSERT SQLì— ì‚¬ìš©í•  ì»¬ëŸ¼ì„ ì§€ì •í•œë‹¤. íŠ¹ì • ê°’ë§Œ ì €ì¥í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•œë‹¤. ìƒëµí•  ìˆ˜ ìˆë‹¤.

`SimpleJdbcInsert`ëŠ” ìƒì„± ì‹œì ì— ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ë©”íƒ€ ë°ì´í„°ë¥¼ ì¡°íšŒí•œë‹¤. ë”°ë¼ì„œ ì–´ë–¤ ì»¬ëŸ¼ì´ ìˆëŠ”ì§€ í™•ì¸ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ `usingColumns`ì„ ìƒëµí•  ìˆ˜ ìˆë‹¤. ë§Œì•½ íŠ¹ì • ì»¬ëŸ¼ë§Œ ì§€ì •í•´ì„œ ì €ì¥í•˜ê³  ì‹¶ë‹¤ë©´ `usingColumns`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•´ë³´ë©´ SimpleJdbcInsertì´ ì–´ë–¤ INSERT SQLì„ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•˜ëŠ”ì§€ ë¡œê·¸ë¡œ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```prolog
DEBUG 39424 --- [           main] o.s.jdbc.core.simple.SimpleJdbcInsert    :
Compiled insert object: insert string is [INSERT INTO item (ITEM_NAME, PRICE,
QUANTITY) VALUES(?, ?, ?)]
```

**save()**

`jdbcInsert.executeAndReturnKey(param)`ì„ ì‚¬ìš©í•´ì„œ INSERT SQLì„ ì‹¤í–‰í•˜ê³ , ìƒì„±ëœ í‚¤ ê°’ë„ ë§¤ìš° í¸ë¦¬í•˜ê²Œ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤.

```java
public Item save(Item item) {
    SqlParameterSource param = new BeanPropertySqlParameterSource(item);
    Number key = jdbcInsert.executeAndReturnKey(param);
    item.setId(key.longValue());
    return item;
}
```

ë‚˜ë¨¸ì§€ëŠ” ì½”ë“œ ë¶€ë¶„ ê¸°ì¡´ê³¼ ê°™ë‹¤.

**JdbcTemplateV3Config**

```java
package hello.itemservice.config;

import hello.itemservice.repository.ItemRepository;
import hello.itemservice.repository.jdbctemplate.JdbcTemplateItemRepositoryV3;
import hello.itemservice.service.ItemService;
import hello.itemservice.service.ItemServiceV1;
import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

import javax.sql.DataSource;

@Configuration
@RequiredArgsConstructor
public class JdbcTemplateV3Config {

    private final DataSource dataSource;

    @Bean
    public ItemService itemService() {
        return new ItemServiceV1(itemRepository());
    }

    @Bean
    public ItemRepository itemRepository() {
        return new JdbcTemplateItemRepositoryV3(dataSource);
    }

}
```

- `JdbcTemplateItemRepositoryV3`ë¥¼ ì‚¬ìš©í•˜ë„ë¡ ìŠ¤í”„ë§ ë¹ˆì— ë“±ë¡í•œë‹¤.

**ItemServiceApplication - ë³€ê²½**

```java
package hello.itemservice;

import hello.itemservice.config.*;
import hello.itemservice.repository.ItemRepository;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Import;
import org.springframework.context.annotation.Profile;

//@Import(MemoryConfig.class)
//@Import(JdbcTemplateV1Config.class)
//@Import(JdbcTemplateV2Config.class)
**@Import(JdbcTemplateV3Config.class)**
@SpringBootApplication(scanBasePackages = "hello.itemservice.web")
public class ItemServiceApplication {

	public static void main(String[] args) {
		SpringApplication.run(ItemServiceApplication.class, args);
	}

	@Bean
	@Profile("local")
	public TestDataInit testDataInit(ItemRepository itemRepository) {
		return new TestDataInit(itemRepository);
	}

}
```

- `JdbcTemplateV3Config.class`ë¥¼ ì„¤ì •ìœ¼ë¡œ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½ë˜ì—ˆë‹¤.
    - `@Import(JdbcTemplateV2Config.class)` â†’ `@Import(JdbcTemplateV3Config.class)`

ì˜ ë™ì‘í•˜ëŠ”ì§€ ì‹¤í–‰í•´ë³´ì.

## JdbcTemplate ê¸°ëŠ¥ ì •ë¦¬

JdbcTemplateì˜ ê¸°ëŠ¥ì„ ê°„ë‹¨íˆ ì •ë¦¬í•´ë³´ì.

### ì£¼ìš” ê¸°ëŠ¥

JdbcTemplateì´ ì œê³µí•˜ëŠ” ì£¼ìš” ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- `JdbcTemplate` : ìˆœì„œ ê¸°ë°˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ ì§€ì›í•œë‹¤.
- `NamedParameterJdbcTemplate` : ì´ë¦„ ê¸°ë°˜ íŒŒë¼ë¯¸í„° ë°”ì¸ë”©ì„ ì§€ì›í•œë‹¤. (ê¶Œì¥)
- `SimpleJdbcInsert` : INSERT SQLì„ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- `SimpleJdbcCall` : ìŠ¤í† ì–´ë„ í”„ë¡œì‹œì €ë¥¼ í¸ë¦¬í•˜ê²Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.

> ğŸ’¡Â ì°¸ê³ 
ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ SimpleJdbcCallì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ ë‹¤ìŒ ìŠ¤í”„ë§ ê³µì‹ ë©”ë‰´ì–¼ì„ ì°¸ê³ í•˜ì.
> 

[Simplifying JDBC Operations with the SimpleJdbc Classes :: Spring Framework](https://docs.spring.io/spring-framework/reference/data-access/jdbc/simple.html#jdbc-simple-jdbc-call-1)

### JdbcTemplate ì‚¬ìš©ë²• ì •ë¦¬

JdbcTemplateì— ëŒ€í•œ ì‚¬ìš©ë²•ì€ ìŠ¤í”„ë§ ê³µì‹ ë©”ë‰´ì–¼ì— ìì„¸íˆ ì†Œê°œë˜ì–´ ìˆë‹¤. ì—¬ê¸°ì„œëŠ” ìŠ¤í”„ë§ ê³µì‹ ë©”ë‰´ì–¼ì´ ì œê³µí•˜ëŠ” ì˜ˆì œë¥¼ í†µí•´ JdbcTemplateì˜ ê¸°ëŠ¥ì„ ê°„ë‹¨íˆ ì •ë¦¬í•´ë³´ì.

> ğŸ’¡Â ì°¸ê³ 
ìŠ¤í”„ë§ JdbcTemplate ì‚¬ìš© ë°©ë²• ê³µì‹ ë©”ë‰´ì–¼
> 

[Using the JDBC Core Classes to Control Basic JDBC Processing and Error Handling :: Spring Framework](https://docs.spring.io/spring-framework/reference/data-access/jdbc/core.html#jdbc-JdbcTemplate)

### ì¡°íšŒ

**ë‹¨ê±´ ì¡°íšŒ - ìˆ«ì ì¡°íšŒ**

```java
int rowCount = jdbcTemplate.queryForObject("select count(*) from t_actor", Integer.class);
```

í•˜ë‚˜ì˜ ë¡œìš°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” `queryForObject()`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì§€ê¸ˆì²˜ëŸ¼ ì¡°íšŒ ëŒ€ìƒì´ ê°ì²´ê°€ ì•„ë‹ˆë¼ ë‹¨ìˆœ ë°ì´í„° í•˜ë‚˜ë¼ë©´ íƒ€ì…ì„ `Integer.class`, `String.class`ì™€ ê°™ì´ ì§€ì •í•´ì£¼ë©´ ëœë‹¤.

**ë‹¨ê±´ ì¡°íšŒ - ìˆ«ì ì¡°íšŒ, íŒŒë¼ë¯¸í„° ë°”ì¸ë”©**

```java
int countOfActorsNamedJoe = jdbcTemplate.queryForObject(
         "select count(*) from t_actor where first_name = ?", Integer.class,"Joe");
```

ìˆ«ì í•˜ë‚˜ì™€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì˜ˆì‹œì´ë‹¤.

**ë‹¨ê±´ ì¡°íšŒ - ë¬¸ì ì¡°íšŒ**

```java
String lastName = jdbcTemplate.queryForObject(
        "select last_name from t_actor where id = ?",
        String.class, 1212L);
```

ë¬¸ì í•˜ë‚˜ì™€ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì˜ˆì‹œì´ë‹¤.

**ë‹¨ê±´ ì¡°íšŒ - ê°ì²´ ì¡°íšŒ**

```java
Actor actor = jdbcTemplate.queryForObject(
        "select first_name, last_name from t_actor where id = ?",
        (resultSet, rowNum) -> {
            Actor newActor = new Actor();
            newActor.setFirstName(resultSet.getString("first_name"));
            newActor.setLastName(resultSet.getString("last_name"));
            return newActor;
				}, 1212L);
```

ê°ì²´ í•˜ë‚˜ë¥¼ ì¡°íšŒí•œë‹¤. ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë§¤í•‘í•´ì•¼ í•˜ë¯€ë¡œ `RowMapper`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ì—¬ê¸°ì„œëŠ” ëŒë‹¤ë¥¼ ì‚¬ìš©í–ˆë‹¤.

**ëª©ë¡ ì¡°íšŒ - ê°ì²´**

```java
List<Actor> actors = jdbcTemplate.query(
      "select first_name, last_name from t_actor",
      (resultSet, rowNum) -> {
          Actor actor = new Actor();
          actor.setFirstName(resultSet.getString("first_name"));
          actor.setLastName(resultSet.getString("last_name"));
          return actor;
```

ì—¬ëŸ¬ ë¡œìš°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” `query()`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ê²°ê³¼ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•œë‹¤.

ê²°ê³¼ë¥¼ ê°ì²´ë¡œ ë§¤í•‘í•´ì•¼ í•˜ë¯€ë¡œ `RowMapper`ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ì—¬ê¸°ì„œëŠ” ëŒë‹¤ë¥¼ ì‚¬ìš©í–ˆë‹¤.

**ëª©ë¡ ì¡°íšŒ - ê°ì²´**

```java
private final RowMapper<Actor> actorRowMapper = (resultSet, rowNum) -> {
      Actor actor = new Actor();
      actor.setFirstName(resultSet.getString("first_name"));
      actor.setLastName(resultSet.getString("last_name"));
      return actor;
};

public List<Actor> findAllActors() {
    return this.jdbcTemplate.query("select first_name, last_name from t_actor", actorRowMapper);
}
```

ì—¬ëŸ¬ ë¡œìš°ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” `query()`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ê²°ê³¼ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•œë‹¤.

ì—¬ê¸°ì„œëŠ” `RowMapper`ë¥¼ ë¶„ë¦¬í–ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ì—¬ëŸ¬ ê³³ì—ì„œ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.

### ë³€ê²½(INSERT, UPDATE, DELETE)

ë°ì´í„°ë¥¼ ë³€ê²½í•  ë•ŒëŠ” `jdbcTemplate.update()`ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. ì°¸ê³ ë¡œ `int` ë°˜í™˜ê°’ì„ ë°˜í™˜í•˜ëŠ”ë°, SQL ì‹¤í–‰ ê²°ê³¼ì— ì˜í–¥ë°›ì€ ë¡œìš° ìˆ˜ë¥¼ ë°˜í™˜í•œë‹¤.

**ë“±ë¡**

```java
jdbcTemplate.update(
      "insert into t_actor (first_name, last_name) values (?, ?)",
      "Leonor", "Watling");
```

**ìˆ˜ì •**

```java
jdbcTemplate.update(
      "update t_actor set last_name = ? where id = ?",
      "Banjo", 5276L);
```

**ì‚­ì œ**

```java
jdbcTemplate.update(
      "delete from t_actor where id = ?",
      Long.valueOf(actorId));
```

### ê¸°íƒ€ ê¸°ëŠ¥

ì„ì˜ì˜ SQLì„ ì‹¤í–‰í•  ë•ŒëŠ” execute()ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤. í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” DDLì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

**DDL**

```java
jdbcTemplate.execute("create table mytable (id integer, name varchar(100))");
```

**ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € í˜¸ì¶œ**

```java
jdbcTemplate.update(
        "call SUPPORT.REFRESH_ACTORS_SUMMARY(?)",
        Long.valueOf(unionId));
```

### ì •ë¦¬

ì‹¤ë¬´ì—ì„œ ê°€ì¥ ê°„ë‹¨í•˜ê³  ì‹¤ìš©ì ì¸ ë°©ë²•ìœ¼ë¡œ SQLì„ ì‚¬ìš©í•˜ë ¤ë©´ JdbcTemplateì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

JPAì™€ ê°™ì´ ORM ê¸°ìˆ ì„ ì‚¬ìš©í•˜ë©´ì„œ ë™ì‹œì— SQLì„ ì§ì ‘ ì‘ì„±í•´ì•¼ í•  ë•Œê°€ ìˆëŠ”ë°, ê·¸ë•Œë„ JdbcTemplateì„ í•¨ê»˜ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

í•˜ë””ì  ë™ì  ì¿¼ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•´ì£¼ì§€ ëª»í•˜ëŠ”ë° ì´ë¥¼ í•´ê²°í•´ì£¼ëŠ”ê²Œ MyBatisì´ë‹¤.